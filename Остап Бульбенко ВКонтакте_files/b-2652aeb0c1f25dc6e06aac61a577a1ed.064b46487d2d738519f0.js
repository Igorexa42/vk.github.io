(self.webpackChunkvk=self.webpackChunkvk||[]).push([[911],{87834:function(e,t,s){"use strict";s.d(t,{API_VERSION:function(){return r},THROTTLE_SCROLL_TIME:function(){return a},VKPAY_TRANSACTION_EVENT:function(){return i},PLATFORM:function(){return n},ERROR_CODES:function(){return o},ERROR_REASONS:function(){return p},ERROR_TYPES:function(){return c},CLOSE_STATUS:function(){return d},GROUP_STATUS:function(){return l},VKPAY_APPS:function(){return h},TEXTLIVE_APPS:function(){return _},VK_CONNECT_EVENTS:function(){return u},PROMO_NEWSLETTER_INTENT:function(){return m},NON_PROMO_NEWSLETTER_INTENT:function(){return R},CONFIRMED_NOTIFICATION_INTENT:function(){return E},VK_CONNECT_SUPERAPPKIT_EVENT_TYPE:function(){return A}});var r="5.95",a=200,i="VKWebAppActionDone",n={WEB:"web",MOBILE_WEB:"mobile-web"},o={UNKNOWN:1,MISSING_PARAM:2,OLD_MISSING_PARAM:100,CONNECTION_LOST:3,USER_DENIED:4,INVALID_PARAMS:5,UNSUPPORTED_PLATFORM:6,REQUESTS_LIMIT_REACHED:10,ACCESS_DENIED:11,CUSTOM:13},p={ACCESS_DENIED:"Access denied",UNSUPPORTED_PLATFORM:"Unsupported platform",UNSUPPORTED_ACTION:"Unsupported action",NATIVE_APP_IS_NOT_INSTALLED:"VK client is not installed on device",USER_NOT_A_PRIVATE_GROUP_MEMBER:"User is not a member of the given private group",UNKNOWN_ERROR:"Unknown error",CONNECTION_LOST:"Connection lost",NETWORK_ERROR:"Network error",USER_DENIED:"User denied",INVALID_PARAMS:"Invalid params",NO_ADS:"No ads",ADS_ALREADY_PLAYED:"Ads already played",VK_PAY_DISABLED:"This app can't use VK Pay",SCROLL_SUBSCRIBER_ALREADY_EXIST:"Scroll subscriber already exist",SUBSCRIPTION_IS_ALREADY_CANCELLED:"Subscription is in invalid status: subscription is already cancelled",SURVEY_INIT_IN_PROGRESS:"Survey init in progress",SURVEY_ALREADY_INIT:"Survey already init",SURVEY_NO_MATCH:"Survey no match",SURVEY_USER_CANCEL:"Survey user cancel",ALREADY_IN_PROGRESS:"Already in progress",USER_IS_NOT_GROUP_ADMIN:"Only group admins have access to group tokens"},c={CLIENT:"client_error",API:"api_error",AUTH:"auth_error"},d=["success","failed"],l={OPEN:0,CLOSED:1,PRIVATE:2},h=[6217559,7131443],_=[7512376],u={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppAddToFavorites:"add_to_favorites",VKWebAppAddToFavoritesPreload:"already_added_to_favorites",VKWebAppAddToMenu:"add_to_menu",VKWebAppAddToMenuPreload:"is_in_left_menu",VKWebAppGetCommunityToken:"get_community_token",VKWebAppGetCommunityTokenPreload:"get_community_preload_settings",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetPhoneNumberPreload:"already_get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppGetEmailPreload:"already_get_email",VKWebAppGetFriends:"get_friends",VKWebAppAllowNotificationsPreload:"are_notifications_allowed",VKWebAppAllowNotifications:"allow_notifications",VKWebAppDenyNotifications:"deny_notifications",VKWebAppAllowMessagesFromGroup:"allow_messages_from_group",VKWebAppAllowMessagesFromGroupPreload:"can_send_messages_from_group",VKWebAppJoinGroup:"join_group",VKWebAppJoinGroupPreload:"is_group_member",VKWebAppLeaveGroup:"leave_group",VKWebAppLeaveGroupPreload:"is_group_member",VKWebAppOpenApp:"open_app",VKWebAppSendPayload:"send_payload",VKWebAppSendToClient:"send_to_client",VKWebAppSendToClientPreload:"get_open_in_native_permission",VKWebAppShowOrderBox:"order",VKWebAppShowSubscriptionBox:"subscription",VKWebAppShowLeaderBoardBox:"show_leader_board",VKWebAppShowInviteBox:"invite_friends",VKWebAppShowStoryBox:"story_box",VKWebAppShowRequestBox:"send_request",VKWebAppShowRequestBoxPreload:"request_box_preload",VKWebAppStorageGetKeys:"storage_get_keys",VKWebAppStorageSet:"storage_set",VKWebAppStorageGet:"storage_get",VKWebAppOpenArticleEditor:"open_article_edit",VKWebAppSubscribeStoryApp:"subscribe_story_app",VKWebAppClose:"close",VKWebAppGetSilentToken:"get_silent_token",VKWebAppCheckAllowedScopes:"check_allowed_scopes",VKWebAppOpenPayForm:"open_pay_form",VKWebAppCheckSurvey:"check_survey",VKWebAppShowSurvey:"show_survey"},m="promo_newsletter",R="non_promo_newsletter",E="confirmed_notification",A="vk-sak-sdk"},35440:function(e,t,s){"use strict";s.d(t,{Handler:function(){return l}});var r=s(34608),a=s(87834);var i=class{constructor(e,t,s=a.ERROR_TYPES.CLIENT){this.data=t||{},this.method=e,this.type=s}_errorStrucuture(e,t){var s={type:this.method,data:{error_type:this.type,error_data:{error_code:e}}};return this.type===a.ERROR_TYPES.API?s.data.error_data.error_msg=t:s.data.error_data.error_reason=t,this.data.request_id&&(s.data.request_id=this.data.request_id),this.data.description&&(s.data.error_data.error_description=this.data.description),s}selectErrorType(){if(!this.data.hasOwnProperty("code"))return this.data.error_msg&&"operation denied by user"===this.data.error_msg.toLowerCase()?this._errorStrucuture(a.ERROR_CODES.USER_DENIED,"User denied"):this._errorStrucuture(a.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||a.ERROR_REASONS.UNKNOWN_ERROR);switch(this.data.code){case a.ERROR_CODES.MISSING_PARAM:return this._errorStrucuture(a.ERROR_CODES.MISSING_PARAM,this.data.reason||"Missing required params or wrong type of param");case a.ERROR_CODES.CONNECTION_LOST:return this._errorStrucuture(a.ERROR_CODES.CONNECTION_LOST,this.data.reason||a.ERROR_REASONS.CONNECTION_LOST);case a.ERROR_CODES.USER_DENIED:return this._errorStrucuture(a.ERROR_CODES.USER_DENIED,this.data.reason||a.ERROR_REASONS.USER_DENIED);case a.ERROR_CODES.INVALID_PARAMS:return this._errorStrucuture(a.ERROR_CODES.INVALID_PARAMS,this.data.reason||a.ERROR_REASONS.INVALID_PARAMS);case a.ERROR_CODES.ACCESS_DENIED:return this._errorStrucuture(a.ERROR_CODES.ACCESS_DENIED,this.data.reason||a.ERROR_REASONS.ACCESS_DENIED);case a.ERROR_CODES.CUSTOM:return this._errorStrucuture(a.ERROR_CODES.CUSTOM,this.data.reason||this.data.error_msg);case a.ERROR_CODES.REQUESTS_LIMIT_REACHED:return this._errorStrucuture(a.ERROR_CODES.REQUESTS_LIMIT_REACHED,"Requests limit reached");case a.ERROR_CODES.UNKNOWN:return this._errorStrucuture(a.ERROR_CODES.UNKNOWN,a.ERROR_REASONS.UNKNOWN_ERROR);default:return this._errorStrucuture(this.data.code?this.data.code:a.ERROR_CODES.UNKNOWN,this.data.reason||this.data.error_msg||"Unknown error")}}},n=s(9579),o=s(61540),p=s(40906),c=s(72946),d=s(59442);class l{constructor(e={}){this.params={handlerName:"handler",method:"method",...e},this.callApi=!0,this.useUI=!1,this.callback=null,this.modal=null,this.isWebOnly=!1,this.isMobileWebOnly=!1,this.actionHandler=this.actionHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),this.successHandler=this.successHandler.bind(this),this.denyUIAction=this.denyUIAction.bind(this),this.allowUIAction=this.allowUIAction.bind(this),cur.vkAppSuccessHandler=this.successHandler,cur.vkAppErrorHandler=this.errorHandler,this.checkResponse=this.checkResponse.bind(this)}get successDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Result`}get errorDescriptor(){return`${this.params.originalHandlerName||this.params.handlerName}Failed`}getEventHash(e=!1){return cur.app.options[`${a.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]}_hash`]}getEventHashes(e=!1){return cur.app.options[`${a.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]}_hashes`]}getEventName(e=!1){return a.VK_CONNECT_EVENTS[`${this.params.handlerName}${e?"Preload":""}`]}sendNetworkError(){this.errorHandler({code:a.ERROR_CODES.UNKNOWN,error_type:a.ERROR_TYPES.CLIENT,reason:a.ERROR_REASONS.UNKNOWN_ERROR})}sendConnectionLostError(){this.errorHandler({code:a.ERROR_CODES.CONNECTION_LOST,error_type:a.ERROR_TYPES.CLIENT,reason:a.ERROR_REASONS.CONNECTION_LOST})}sendUserDeniedError(){this.errorHandler({code:a.ERROR_CODES.USER_DENIED,error_type:a.ERROR_TYPES.CLIENT,reason:a.ERROR_REASONS.USER_DENIED})}handleApiError(e){var t=null==e?void 0:e.error,s=null==t?void 0:t.error_msg,r=null==t?void 0:t.error_code;if(r)switch(r){case d.API_ERROR_ACCESS:this.errorHandler({code:a.ERROR_CODES.ACCESS_DENIED,error_type:a.ERROR_TYPES.CLIENT,reason:s});break;case d.API_ERROR_PARAM:this.errorHandler({code:a.ERROR_CODES.INVALID_PARAMS,error_type:a.ERROR_TYPES.CLIENT,reason:s});break;default:this.errorHandler({code:a.ERROR_CODES.CUSTOM,error_type:a.ERROR_TYPES.CLIENT,reason:s||a.ERROR_REASONS.UNKNOWN_ERROR})}else this.errorHandler({code:a.ERROR_CODES.CONNECTION_LOST,error_type:a.ERROR_TYPES.CLIENT,reason:s||a.ERROR_REASONS.UNKNOWN_ERROR})}sendCustomError(e){this.errorHandler({code:a.ERROR_CODES.CUSTOM,reason:e||a.ERROR_REASONS.UNKNOWN_ERROR})}checkParams(e,t){for(var s=0;s<t.length;s++){var{param:r,type:i,isRequired:n,extraChecks:o}=t[s];if(!e.hasOwnProperty(r)&&n)return this.errorHandler({code:a.ERROR_CODES.MISSING_PARAM,reason:`Missing required param "${r}"`}),!1;if(e.hasOwnProperty(r)&&typeof e[r]!==i)return this.errorHandler({code:a.ERROR_CODES.INVALID_PARAMS,reason:`Param "${r}" should be ${i}`},this.callback),!1;if(e.hasOwnProperty(r)&&o&&o.length>0)for(var p=0;p<o.length;p++)if(!o[p].check(e[r]))return this.errorHandler({code:a.ERROR_CODES.INVALID_PARAMS,reason:o[p].error(r)},this.callback),!1}return!0}actionHandler(e){return this.callApi?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,...e},{onDone:t=>{this.handleResponse(t,e,this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)}):{}}checkResponse(e){1===e||0===e?this.successHandler(Boolean(e)):this.successHandler(e)}scopeStringToArray(e){return e?e.replace(/ /g,"").split(","):[]}denyUIAction(){this.errorHandler({error_type:"client_error",code:a.ERROR_CODES.USER_DENIED},null),r.default.pop(this.modal)}allowUIAction(e){this.actionHandler(e),r.default.pop(this.modal)}createDenyUIAction(e){this.params.modal.cancelAction=void 0!==e?()=>this.denyUIAction(e):this.denyUIAction}createAllowUIAction(e){this.params.modal.allowAction=void 0!==e?()=>this.allowUIAction(e):this.allowUIAction}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(),this.modal=new n.UIAction({...this.params.modal,...e}),r.default.push(this.modal)}_enhanceBtnsWithActions(){this.params.modal.buttons&&this.params.modal.buttons.forEach(((e,t)=>{"deny"===e.type?this.params.modal.buttons[t].action=this.params.modal.cancelAction:this.params.modal.buttons[t].action=this.params.modal.allowAction}))}setData(e,t,s=null){s&&(this.callback=s),e.request_id&&(this.params.request_id=e.request_id),this.params.modal||(this.params.modal={}),e.containerId&&(this.params.modal.containerId=e.containerId),e.pic&&(this.params.modal.pic=e.pic),this.app=t}handleResponse(e,t,s,r){try{var a=JSON.parse(e);a.hasOwnProperty("error")?this.errorHandler(a.error):s(a,t)}catch(e){r?r(e):this.errorHandler(e)}}handler(e,t,s){if(this.setData(e,t),this.callback=s,this.isWebOnly&&(0,o.isMvk)()||this.isMobileWebOnly&&!(0,o.isMvk)())return this.errorHandler({code:a.ERROR_CODES.UNSUPPORTED_PLATFORM,error_type:a.ERROR_TYPES.CLIENT,reason:a.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.useUI?this.launchUI(e):this.useUI||this.actionHandler(e)}getAppWebviewUrl(){return cur.app.frame.src}successHandler(e,t){t&&t(),(0,p.isObject)(e)||(e={result:e}),this.params.request_id&&e&&(e.request_id=this.params.request_id),this.callback({type:this.successDescriptor,data:e},this.params.handlerName),(0,o.isMvk)()&&cur.app.frame.focus(),c.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!0})}errorHandler(e,t,s){"string"==typeof e&&(e={reason:e}),this.params.request_id&&(e.request_id=this.params.request_id);var r=new i(this.errorDescriptor,e,s);t&&t(),this.callback(r.selectErrorType()),(0,o.isMvk)()&&cur.app.frame.focus(),c.bridgeEventItemStat.logEvent(this.getAppWebviewUrl(),this.app.appId,{event_type:this.params.handlerName,is_success:!1},{error_type:r.type,error_code:r.data.code})}}},73871:function(e,t,s){"use strict";s.d(t,{VKWebAppAddToProfile:function(){return p}});var r=s(35440),a=s(61540),i=s(87834),n=s(27488),o=s(1581);class p extends r.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppAddToProfile"}isValidParams(e){return this.checkParams(e,[{param:"ttl",type:"number"}])}actionHandler(e){if((0,n.isProfileButtonAvailable)()&&this.isValidParams(e))if((0,n.isProfileButtonInstalled)())this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"The button is already installed in the profile"});else{var t=e.ttl||0;if(!(0,a.isMvk)())return this.addToProfileSuccess=this.addToProfileSuccess.bind(this),this.addToProfileFailed=this.addToProfileFailed.bind(this),void window.Apps.loadAddToProfile(t).then(this.addToProfileSuccess).catch(this.addToProfileFailed);(0,o.setAddToProfileBridgeContext)(this),window.MiniAppsProfileButtons.showAddToProfile(t)}}addToProfileSuccess(e){this.successHandler({privacy:e})}addToProfileFailed(e){this.errorHandler({code:e})}}},64309:function(e,t,s){"use strict";s.d(t,{VKWebAppRemoveFromProfile:function(){return o}});var r=s(35440),a=s(61540),i=s(27488),n=s(1581);class o extends r.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppRemoveFromProfile"}actionHandler(e){if((0,i.isProfileButtonAvailable)())if((0,i.isProfileButtonInstalled)()){if(!(0,a.isMvk)())return this.removeFromProfileSuccess=this.removeFromProfileSuccess.bind(this),this.removeFromProfileFailed=this.removeFromProfileFailed.bind(this),void window.Apps.loadRemoveFromProfile().then(this.removeFromProfileSuccess).catch(this.removeFromProfileFailed);(0,n.setRemoveFromProfileBridgeContext)(this),window.MiniAppsProfileButtons.showRemoveFromProfile()}else this.removeFromProfileSuccess()}removeFromProfileSuccess(){this.successHandler({result:!0})}removeFromProfileFailed(e){this.errorHandler({code:e})}}},29853:function(e,t,s){"use strict";s.d(t,{VKWebAppShowGoodOrderBox:function(){return _}});var r=s(35440),a=s(9579),i=s(34608),n=s(87834),o=s(61540),p=s(30038),c=s(89798),d=s(84607),l=-1,h=1;class _ extends r.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowGoodOrderBox",this.useUI=!1,this.callApi=!1,this.isAborted=!1,this.controller="/apps",this.itemId="",this.payment_url="",this.params.modal={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.denyUIAction.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.createOrder.bind(this)}],containerClass:"vk_app_modal_container--order",allowAction:this.createOrder.bind(this),cancelAction:this.denyUIAction.bind(this),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0},this.rawData=null}setData(e,t){super.setData(e,t),this.itemId=this.itemId?this.itemId:e.external_item_id,this.rawData=e}showLoader(e=!1){var t=e?this.abortLoading.bind(this):this.denyUIAction.bind(this),s=[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:t}];e||s.push({title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.denyUIAction,disabled:!0});var r={buttons:s,title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_buy_waiting_item_desc"),cancelAction:t,picClass:"vk_app_modal_container__pic--loader",pic:"/images/svg_icons/vk_apps/vk_app_spinner_100.svg",containerId:this.params.modal.containerId,onlyButtonHide:!0};this.loader=new a.UIAction(r),i.default.push(this.loader)}hideLoader(){this.loader&&(i.default.pop(this.loader),this.loader.destroy()),this.loader=null}abortLoading(){this.isAborted=!0,this.denyUIAction()}handler(e,t,s){if(this.setData(e,t),this.callback=s,this.rawData.type&&this.rawData.external_item_id)return(0,o.isMvk)()?(this.showLoader(),void this.makeOrder()):void this.handleWeb();this.errorHandler({code:n.ERROR_CODES.INVALID_PARAMS})}handleWeb(){!function(e,t,s,r){var a={},i=window.cur.app;for(var o in e)["type","external_item_id"].includes(o)&&(a[o]=e[o].toString());a.act="card_payment_box",a.app_id=i.options.aid,a.hash=i.options.hash;var p=!1;cur.isPaymentsAppOrder=!0,window.showBox("al_payments.php",a,{params:{dark:1,onHide(){p||r()}},onDone(e,t){p=!0},onFail:e=>(p=!0,void 0===e&&i.options.embed||(window.showFastBox({title:getLang("global_error")},e),s(n.ERROR_CODES.INVALID_PARAMS)),!0)}),cur.onAppOrderCancel=()=>{r()},cur.onAppOrderSuccess=e=>{t(e)},cur.onAppOrderFail=e=>{s(e)}}(this.rawData,(e=>{this.orderId=e,this.initCheckOrder()}),(()=>{this.errorHandler({reason:"Order error",code:n.ERROR_CODES.CUSTOM})}),(()=>{this.errorHandler({code:n.ERROR_CODES.USER_DENIED})}))}makeOrder(){this.loadItemData().then((e=>{this.showConfirm(e)})).catch(this.onError.bind(this)).finally(this.hideLoader.bind(this))}showConfirm(e){this.params.modal.pic=e.image_url,this.params.modal.title=e.title,this.params.modal.text=e.description,this.modal=new a.UIAction({...this.params.modal}),i.default.push(this.modal);var t=document.querySelector(".vk_app_modal_container__pic");t&&(t.onload=()=>{t.classList.add("vk_app_modal_container__pic--loaded")})}loadItemData(){return(0,c.api)("goodsOrders.getItemData",{item_id:this.itemId,app_id:this.app.appId})}requestCreateOrder(){return(0,c.api)("goodsOrders.createOrder",{item_id:this.itemId,app_id:this.app.appId})}cancel(){this.denyUIAction(),this.hideLoader()}onError(){this.sendNetworkError(),i.default.pop(this.modal),this.showOrderErrorModal()}createOrder(){this.showLoader(),this.requestCreateOrder().then((e=>{window.nav.go(e.payment_url)})).catch(this.onError.bind(this)).finally(this.hideLoader.bind(this))}showOrderErrorModal(){this.showResultModal(getLang("vkapps_connect_auto_buy_error_title"),getLang("vkapps_connect_auto_buy_error_desc"),this.getWarningIcon())}showResultModal(e,t,s){var r=new a.UIAction({title:e,text:t,buttons:[{title:getLang("vkapps_connect_modal_continue_play"),type:"success"}],withoutAnimation:!0,containerId:this.params.modal.containerId,containerClass:"vk_app_modal_container--order",svgIcon:s,cancelAction:()=>{i.default.pop(r)},allowAction:()=>{i.default.pop(r)}});i.default.push(r)}getWarningIcon(){var e=document.createElement("div");return e.className="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--warning",e.innerHTML=(0,p.getIcon56ErrorTriangleOutline)().icon,e.outerHTML}initCheckOrder(){this.showLoader(!0),this.checkOrder()}checkOrder(){this.requestCheckOrder().then((e=>e.order_status===h?(this.hideLoader(),this.showOrderSuccessModal(),!1):e.order_status!==l||(this.hideLoader(),i.default.pop(this.modal),this.errorHandler(e.error),this.showOrderErrorModal(),!1))).catch((e=>(console.error(e),!0))).then((e=>{e&&!this.isAborted&&(this.interval=setTimeout((()=>{this.checkOrder()}),1e3))}))}showOrderSuccessModal(){this.successHandler({success:!0,order_id:this.orderId}),this.showResultModal(getLang("vkapps_connect_auto_buy_success_title"),getLang("vkapps_connect_auto_buy_success_desc"),this.getSuccessIcon())}getSuccessIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--success">\n      ${(0,d.getIcon56CheckCircleOutline)().icon}\n    </div>\n    `}requestCheckOrder(){return(0,c.api)("goodsOrders.getOrder",{order_id:this.orderId})}}},94105:function(e,t,s){"use strict";s.d(t,{VKWebAppShowOrderBox:function(){return h}});var r=s(35440),a=s(9579),i=s(34608),n=s(87834),o=s(61540),p=s(30038),c=s(84607),d={error_type:"client_error",code:n.ERROR_CODES.CONNECTION_LOST},l="disabled";class h extends r.Handler{constructor(e){super(e),this.getAutoBuyCheckboxState=()=>{var e;return this.isAutoByVisible&&this.params.modal.checkbox?(null==(e=this.params.modal.checkbox[0])?void 0:e.checked)?"checked":"unchecked":l},this.appendAutoByCheckBox=()=>{this.isAutoByVisible&&(this.params.modal.checkbox=this.params.modal.checkbox||[],this.params.modal.checkbox[0]={title:getLang("vkapps_connect_auto_buy_title"),description:getLang("vkapps_connect_auto_buy_desc"),checked:this.isAutoBuyChecked},this.params.modal.containerClass="vk_app_modal_container--order vk_app_modal_container--orderAutoBuy")},this.showConfirm=e=>{this.params.modal.pic=e.photo_url,this.params.modal.title=e.title,this.params.modal.text=e.message,this.appendAutoByCheckBox(),this.modal=new a.UIAction({...this.params.modal}),i.default.push(this.modal);var t=document.querySelector(".vk_app_modal_container__pic");t&&(t.onload=()=>{t.classList.add("vk_app_modal_container__pic--loaded")})},this.loadItemData=()=>new Promise(((e,t)=>{var s=0;this.interval=setInterval((()=>{ajax.post(this.controller,{act:"handle_vk_connect_event",event:this.getEventName(),hash:this.getEventHash(),item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,_ajax:1},{onDone:r=>{switch((r=JSON.parse(r)).hasOwnProperty("error")&&t(r.error),r.status){case"waiting":this.orderId=r.order_id,s++>=30&&t({code:n.ERROR_CODES.CUSTOM,reason:"Can't load product"});break;case"loaded":this.orderId=r.order_id,this.confirmHash=r.confirm_hash,this.orderHash=r.order_hash,this.isAutoBuyChecked=r.is_auto_buy_checked,this.isAutoBuyEnabled=r.is_auto_buy_enabled,this.isAutoByVisible=r.is_auto_buy_checkbox_visible,e(r.item_data)}},onFail:()=>{t(d)}})}),1e3)})),this.confirmOrder=()=>{this.hideLoader(),ajax.post(this.controller,{act:"handle_vk_connect_event",event:"confirm_order",item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,hash:this.confirmHash,order_hash:this.orderHash,auto_buy_checked:this.getAutoBuyCheckboxState()},{onDone:e=>{if("charged"===(e=JSON.parse(e)).status?(this.successHandler({success:!0,order_id:e.order_id}),i.default.pop(this.modal),this.showOrderSuccessModal()):(i.default.pop(this.modal),this.errorHandler(e.error),this.showOrderErrorModal()),(0,o.isMvk)()){var t=new URL(location.href);["confirm_order","order_id"].forEach((e=>t.searchParams.delete(e))),nav.set({replace:!0,nav:{...nav,cur:nav.path,push:t.pathname+t.search+t.hash}})}},onFail:()=>{this.onError(d)}})},this.showOrderSuccessModal=()=>{this.showResultModal(getLang("vkapps_connect_auto_buy_success_title"),getLang("vkapps_connect_auto_buy_success_desc"),this.getSuccessIcon())},this.showOrderErrorModal=()=>{this.showResultModal(getLang("vkapps_connect_auto_buy_error_title"),getLang("vkapps_connect_auto_buy_error_desc"),this.getWarningIcon())},this.showResultModal=(e,t,s)=>{var r=new a.UIAction({title:e,text:t,buttons:[{title:getLang("vkapps_connect_modal_continue_play"),type:"success"}],withoutAnimation:!0,containerId:this.params.modal.containerId,containerClass:"vk_app_modal_container--order",svgIcon:s,cancelAction:()=>{i.default.pop(r)},allowAction:()=>{i.default.pop(r)}});i.default.push(r)},this.params.handlerName="VKWebAppShowOrderBox",this.useUI=!1,this.callApi=!1,this.controller="/apps",this.itemId="",this.orderId=0,this.isAutoBuyEnabled=!1,this.isAutoBuyChecked=!1,this.isAutoByVisible=!1,this.params.modal={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.confirmOrder}],containerClass:"vk_app_modal_container--order",allowAction:this.confirmOrder,cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0},this.rawData=null}setData(e,t){super.setData(e,t),this.itemId=this.itemId?this.itemId:e.item,this.rawData=e}showLoader(){var e={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.cancel.bind(this),disabled:!0}],title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_buy_waiting_item_desc"),cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--loader",pic:"/images/svg_icons/vk_apps/vk_app_spinner_100.svg",containerId:this.params.modal.containerId,onlyButtonHide:!0};this.loader=new a.UIAction({...e}),i.default.push(this.loader)}hideLoader(){this.loader&&(i.default.pop(this.loader),this.loader.destroy()),this.loader=null}handler(e,t,s){this.setData(e,t),this.callback=s,this.rawData.type&&this.rawData.item?(0,o.isMvk)()?(this.showLoader(),this.makeOrder()):(window.cur.app.registerVkBridgeCallback("onOrderCancel",(()=>{this.errorHandler({code:n.ERROR_CODES.USER_DENIED})})),window.cur.app.registerVkBridgeCallback("onOrderSuccess",(e=>{this.successHandler({success:!0,order_id:e})})),window.cur.app.registerVkBridgeCallback("onOrderFail",(()=>{this.errorHandler({reason:"Order error",code:n.ERROR_CODES.CUSTOM})})),window.cur.app.funcs.showOrderBox(this.rawData)):this.errorHandler({code:n.ERROR_CODES.INVALID_PARAMS})}makeOrder(){this.loadItemData().then((e=>{clearInterval(this.interval),this.hideLoader(),this.isAutoBuyEnabled?this.confirmOrder():this.showConfirm(e)})).catch((e=>{this.onError(e)}))}cancel(){clearInterval(this.interval),this.denyUIAction(),this.hideLoader()}onError(e){clearInterval(this.interval),this.errorHandler(e),i.default.pop(this.modal),this.hideLoader(),this.showOrderErrorModal()}getWarningIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--warning">\n      ${(0,p.getIcon56ErrorTriangleOutline)().icon}\n    </div>\n    `}getSuccessIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--success">\n      ${(0,c.getIcon56CheckCircleOutline)().icon}\n    </div>\n    `}}},34608:function(e,t){"use strict";t.default=new class{constructor(){this.checkStack=()=>{cur.vkMiniAppsStack||(cur.vkMiniAppsStack=[])},this.checkStack(),cur.clearVKMiniAppsLayerPopups=this.clearLayerPopups.bind(this)}push(e){e.init(),this.checkStack(),0===cur.vkMiniAppsStack.length&&e.show(),cur.vkMiniAppsStack.push(e)}clearLayerPopups(){this.checkStack(),cur.vkMiniAppsStack.length>0&&(cur.vkMiniAppsStack=cur.vkMiniAppsStack.filter((e=>!~e.appNode.id.indexOf("container_layer"))))}pop(e){var t=cur.vkMiniAppsStack.indexOf(e);~t&&(cur.vkMiniAppsStack.splice(t,1),this.checkForNext())}checkForNext(){cur.vkMiniAppsStack.length>0&&cur.vkMiniAppsStack[0].show()}}},9579:function(e,t,s){"use strict";s.d(t,{CLOSE_BUTTON_MODES:function(){return c},UIAction:function(){return d}});var r=s(61540),a=s(15893),i=s(60804),n=s(62816),o=s(84502),p=s(20130),c={INNER:0,OUTER:1};class d{constructor(e,t){this.props={...e},t&&(this.callback=t),this.props.buttons=this.props.buttons||[],this.containerNode=document.getElementById(this.props.containerId),this.modal=null,this.modalParentLayer=null,this.onAction=this.onAction.bind(this),this.addScroll=(0,a.throttle)(this.addScroll.bind(this),300),this.renderModal(),this._destroyed=!1}addScroll(){((e,t)=>{var s=t?t.scrollTop:window.pageYOffset,a=window.cur.app;if(a&&!(0,r.isMvk)()){var i=a.frame.clientHeight-360,n=Math.max(103,Math.min(s,i));requestAnimationFrame((function(){e.style.transform=`translateX(-50%) translateY(${n}px)`}))}})(this.modal.children[0],this.modalParentLayer)}init(){this.containerNode&&this.containerNode.appendChild(this.modal),this.modalParentLayer=this.modal.closest(".layer_wrap"),this.modalParentLayer?this.modalParentLayer.addEventListener("scroll",this.addScroll):window.addEventListener("scroll",this.addScroll)}show(){(0,r.isMvk)()&&document.body.classList.add("vk_app_fixed"),this.props.withoutAnimation?this.modal.classList.add("show"):setTimeout((()=>this.modal.classList.add("show")),300),this.initMvkCloseActions(),this.addScroll()}initMvkCloseActions(){if((0,r.isMvk)()){if(!window.DirectGames||!cur.app.isDirectGame)return;window.DirectGames.onBoxOpen(this),this.props.onlyButtonHide||(this.modal.onclick=e=>{e.target===this.modal&&this.onAction(this.props.cancelAction)})}}close(){this.props.onlyButtonHide||this.onAction(this.props.cancelAction)}destroy(){window.removeEventListener("scroll",this.addScroll),this.modalParentLayer&&this.modalParentLayer.removeEventListener("scroll",this.addScroll),this._destroyed||((0,r.isMvk)()&&(document.body.classList.remove("vk_app_fixed"),window.DirectGames&&cur.app.isDirectGame&&(window.DirectGames.onBoxClose(this),cur.app.frame.focus())),this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback(),this._destroyed=!0)}onAction(e){e(),this.destroy()}_renderBtn(e){var t=document.createElement("button");if(t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add(`vk_app_modal_btn--${e.type}`),e.disabled&&(t.disabled=e.disabled),e.loading){var s=(0,r.isMvk)()?(0,i.getIcon24Spinner)().icon:(0,n.getIcon16Spinner)().icon;t.innerHTML=`\n        <span class="vk_app_modal_btn__content">${e.title}</span>\n        <span class="vk_app_modal_btn__spinner">${s}</span>\n      `,t.classList.add("vk_app_modal_btn--loading")}else t.innerText=e.title,t.addEventListener("click",(()=>this.onAction(e.action)));return t}_renderBtns(e){var t=e.getElementsByClassName("vk_app_modal_btns")[0];t&&(this.props.buttons.map((e=>{t.appendChild(this._renderBtn(e))})),1===this.props.buttons.length&&t.classList.add("vk_app_modal_btns--single-btn"))}_renderCloseBtn(e){var t=document.createElement("button");t.setAttribute("type","button"),t.classList.add("vk_app_modal_close_btn"),(0,r.isMvk)()||this.props.closeButtonMode!==c.OUTER?t.innerHTML=(0,p.getIcon24Cancel)().icon:(t.classList.add("vk_app_modal_close_btn--outer"),t.innerHTML=(0,o.getIcon20Cancel)().icon),t.addEventListener("click",(()=>this.onAction(this.props.cancelAction))),e.children[0].appendChild(t)}_renderCheckboxFields(e,t){var s=document.createElement("div");s.classList.add("MiniAppsCheckbox__fields");var r=document.createElement("h5");if(r.classList.add("MiniAppsCheckbox__fields-title"),r.innerHTML=e,s.appendChild(r),t){var a=document.createElement("h6");a.classList.add("MiniAppsCheckbox__fields-description"),a.innerHTML=t,s.appendChild(a)}return s}_renderCheckbox(e){var{title:t,description:s,...r}=e,a=document.createElement("label");a.classList.add("MiniAppsCheckbox");var i=document.createElement("input");i.type="checkbox",i.classList.add("MiniAppsCheckbox__checkbox"),i.addEventListener("change",(t=>e.checked=t.target.checked)),a.appendChild(i),Object.entries(r).forEach((([e,t])=>{i[e]=t}));var n=document.createElement("div");n.classList.add("MiniAppsCheckbox__fake_checkbox"),a.appendChild(n);var o=this._renderCheckboxFields(t,s);return a.appendChild(o),a}_renderCheckboxWrap(e){var t=e.querySelector(".MiniAppsModalCheckbox");t&&this.props.checkbox.map((e=>t.appendChild(this._renderCheckbox(e))))}_renderOuter(){var e=document.createElement("div");return e.classList.add("vk_app_modal_outer"),e}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach(((e,t)=>{"deny"===e.type?this.props.buttons[t].action=this.props.cancelAction:this.props.buttons[t].action=this.props.allowAction}))}_renderScopes(e){return e.map(((e,t)=>{var s=getLang(`vkapps_scope_${e}`);return 0===t?s:s.toLowerCase()})).join(", ")}prepareScopes(e){return 0===e.length?["general"]:e}prepareExtraBtn(){var e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("vk_app_modal_btn","vk_app_modal_btn--transparent"),e.innerHTML=getLang("apps_connect_modal_messages_scopes_edit"),e.addEventListener("click",this.props.extraAction),e}getThumb(){if(this.props.svgIcon)return this.props.svgIcon;var e=this.props.picClass?this.props.picClass:"";return this.props.pic?`<img src="${this.props.pic}" class="vk_app_modal_container__pic MiniAppModalContainer__pic ${e}" alt aria-label="product">`:""}renderModal(){this.props.containerClass=this.props.containerClass||"",this.props.buttonsClass=this.props.buttonsClass||"",this.props.isGradientModal&&(0,r.isMvk)()&&(this.props.containerClass+=" MiniAppsGradientModal"),this.props.isNoWrapButtons&&(0,r.isMvk)()&&(this.props.buttonsClass+=" MiniAppsNoWrapButtons");var e=`\n    <div class="vk_app_modal_container vk_app_modal_container--flex ${this.props.containerClass||""}">\n      <div class="vk_app_modal_content">\n        ${this.getThumb()}\n        <h2 class="vk_app_modal_container__heading">${this.props.title}</h2>\n        ${this._renderSubheading()}\n        ${this._renderTextSeparator()}\n        ${this._renderText(this.props.text)}\n      `;this.props.scopes&&(e+=`\n          <p class="vk_app_modal_container__text">${getLang("apps_connect_modal_messages_scopes_text")}</p>\n          <p class="vk_app_modal_container__list">${this._renderScopes(this.prepareScopes(this.props.scopes))}.</p>`),e+=`\n          </div>\n          ${this.props.checkbox?'<div class="MiniAppsModalCheckbox"></div>':""}\n          <div class="vk_app_modal_btns ${this.props.buttonsClass}"></div>\n      </div>`,this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=e,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this.props.scopes&&this.props.scopes.length&&this.props.extraAction&&this.modal.getElementsByClassName("vk_app_modal_content")[0].appendChild(this.prepareExtraBtn()),this._renderBtns(this.modal),this.props.checkbox&&this._renderCheckboxWrap(this.modal)}_renderText(e){return e?(Array.isArray(e)?e:[e]).map((e=>`<p class="vk_app_modal_container__text">${e}</p>`)).join(""):""}_renderSubheading(){return this.props.subheading?`<h3 class="vk_app_modal_container__subheading">${this.props.subheading}</h3>`:""}_renderTextSeparator(){return this.props.isTextSeparated?'<div class="vk_app_modal_container__text_separator"></div>':""}}},40206:function(e,t,s){"use strict";s.d(t,{chooseAction:function(){return dr},sendMessage:function(){return cr}});var r={};s.r(r),s.d(r,{VKWebAppActionDone:function(){return bs},VKWebAppAddToCommunity:function(){return v},VKWebAppAddToFavorites:function(){return ve},VKWebAppAddToHomeScreenInfo:function(){return b},VKWebAppAddToMenu:function(){return be},VKWebAppAddToProfile:function(){return Xs.VKWebAppAddToProfile},VKWebAppAllowMessagesFromGroup:function(){return $},VKWebAppAllowNotifications:function(){return J},VKWebAppCallAPIMethod:function(){return F},VKWebAppChangeFragment:function(){return Qs},VKWebAppCheckAllowedScopes:function(){return Ss},VKWebAppCheckNativeAds:function(){return Os},VKWebAppCheckSurvey:function(){return or},VKWebAppClose:function(){return ye},VKWebAppConversionHit:function(){return Fs},VKWebAppCopyText:function(){return N},VKWebAppCreateHash:function(){return _},VKWebAppCustomMessage:function(){return zs},VKWebAppDenyNotifications:function(){return j},VKWebAppFlashGetInfo:function(){return ds},VKWebAppGetAuthToken:function(){return x},VKWebAppGetClientVersion:function(){return f},VKWebAppGetCommunityAuthToken:function(){return u},VKWebAppGetCommunityToken:function(){return O},VKWebAppGetConfig:function(){return Bs},VKWebAppGetEmail:function(){return T},VKWebAppGetFriends:function(){return ge},VKWebAppGetGeodata:function(){return H},VKWebAppGetGroupInfo:function(){return cs},VKWebAppGetLaunchParams:function(){return vs},VKWebAppGetPersonalCard:function(){return Le},VKWebAppGetPhoneNumber:function(){return P},VKWebAppGetSilentToken:function(){return ms},VKWebAppGetUserInfo:function(){return C},VKWebAppInit:function(){return d},VKWebAppJoinGroup:function(){return G},VKWebAppLeaveGroup:function(){return q},VKWebAppLocationChanged:function(){return ke},VKWebAppOpenApp:function(){return z},VKWebAppOpenArticle:function(){return ie},VKWebAppOpenArticleEditor:function(){return Re},VKWebAppOpenCodeReader:function(){return Ve},VKWebAppOpenContacts:function(){return Me},VKWebAppOpenInNativeApp:function(){return Ie},VKWebAppOpenPayForm:function(){return Y},VKWebAppOpenQR:function(){return D},VKWebAppOpenReportForm:function(){return Rs},VKWebAppOpenWallPost:function(){return _s},VKWebAppRecommend:function(){return qs},VKWebAppRemoveFromProfile:function(){return Zs.VKWebAppRemoveFromProfile},VKWebAppResizeWindow:function(){return te},VKWebAppRetargetingPixel:function(){return gs},VKWebAppScroll:function(){return ee},VKWebAppScrollTop:function(){return Js},VKWebAppScrollTopStart:function(){return js},VKWebAppScrollTopStop:function(){return Ys},VKWebAppSendCustomEvent:function(){return Us},VKWebAppSendPayload:function(){return se},VKWebAppSendToClient:function(){return L},VKWebAppSetLocation:function(){return w},VKWebAppSetTitle:function(){return V},VKWebAppSetViewSettings:function(){return M},VKWebAppShare:function(){return Q},VKWebAppShowCommunityWidgetPreviewBox:function(){return Ne},VKWebAppShowGoodOrderBox:function(){return _e.VKWebAppShowGoodOrderBox},VKWebAppShowImages:function(){return le},VKWebAppShowInstallPushBox:function(){return ns},VKWebAppShowInviteBox:function(){return me},VKWebAppShowLeaderBoardBox:function(){return ue},VKWebAppShowNativeAds:function(){return Ft},VKWebAppShowNewPostBox:function(){return X},VKWebAppShowOrderBox:function(){return he.VKWebAppShowOrderBox},VKWebAppShowRequestBox:function(){return Ee},VKWebAppShowStoryBox:function(){return He},VKWebAppShowSubscriptionBox:function(){return is},VKWebAppShowSurvey:function(){return pr},VKWebAppShowWallPostBox:function(){return Z},VKWebAppStorageGet:function(){return Oe},VKWebAppStorageGetKeys:function(){return Ae},VKWebAppStorageSet:function(){return Se},VKWebAppSubscribeStoryApp:function(){return De},VKWebAppTapticImpactOccurred:function(){return pe},VKWebAppTapticNotificationOccurred:function(){return ce},VKWebAppTapticSelectionChanged:function(){return de},VKWebAppTrackEvent:function(){return As},VKWebAppUpdateConfig:function(){return oe}});var a=s(35440),i=s(55368),n=s(61540),o=s(40906),p=["VKWebAppShowImages"],c=["VKWebAppResizeWindow","VKWebAppAddToMenu","VKWebAppShowInstallPushBox","VKWebAppGetFriends"];class d extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppInit"}handler(e,t,s){var a,d;this.setData(e,t),this.callback=s,this.callback({type:"SetSupportedHandlers",data:{supportedHandlers:Object.keys(r).filter((e=>!((0,n.isMvk)()?c:p).includes(e)))}}),this.successHandler({result:!0}),window.dispatchEvent(new Event(i.CONNECT_EVENTS.INIT));var l=null==(a=cur)||null==(d=a.app)?void 0:d.closedBeforeOpenedAppEvent;(0,o.isObject)(l)&&(this.params.handlerName=i.CONNECT_EVENTS.CLOSE,this.successHandler(l),cur.app.closedBeforeOpenedAppEvent={})}}var l=s(89798),h=s(87834);class _ extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppCreateHash"}actionHandler(e){var t={app_id:cur.aid};e.hasOwnProperty("payload")&&("number"==typeof e.payload||"string"==typeof e.payload)&&(t.request_id=e.payload),(0,l.api)("apps.getSecretHash",t).then((({sign:e,ts:t,request_id:s})=>{var r={sign:e,ts:t};s&&(r.payload=s),this.successHandler(r)})).catch((()=>{this.errorHandler({code:h.ERROR_CODES.CONNECTION_LOST,reason:h.ERROR_REASONS.CONNECTION_LOST})}))}}class u extends a.Handler{actionHandler(e){dr({handler:i.CONNECT_EVENTS.GET_COMMUNITY_TOKEN,params:{...e,originalHandlerName:i.CONNECT_EVENTS.GET_COMMUNITY_AUTH_TOKEN}},this.app)}}var m=s(34608),R=s(9579),E=s(9808),A=s(21149);var S=class{constructor(e,t){this.props={...e},t&&(this.callback=t),this.appNode=document.getElementById(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.onCancelAction=this.onCancelAction.bind(this),this.onAllow=this.onAllow.bind(this)}show(){setTimeout((()=>this.modal.classList.add("show")),300)}destroy(){this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback()}onAction(e){this.props.allowUIAction({scope:e,app_id:this.props.app_id}),this.destroy()}onCancelAction(e){e&&e(),this.destroy()}onAllow(){var e=[];Array.from(this.modal.querySelectorAll(".blind_label:checked")).map((t=>{var s=parseInt(t.id.replace("scope_",""),10);if(!this.props.scopes[s])throw new Error("There is no such scope");e.push(this.props.scopes[s])})),this.onAction(e.join(","))}_renderBtn(e){var t=document.createElement("button");return t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add(`vk_app_modal_btn--${e.type}`),t.innerText=e.title,"success"===e.type?t.addEventListener("click",(()=>this.onAllow())):t.addEventListener("click",(()=>this.onCancelAction(e.action))),t}_renderBtns(e){this.props.buttons.map((t=>{e.getElementsByClassName("vk_app_modal_btns")[0].appendChild(this._renderBtn(t))}))}_renderCloseBtn(e){var t=document.createElement("div");t.setAttribute("aria-label","Close"),t.setAttribute("tabindex","0"),t.setAttribute("role","button"),t.classList.add("box_x_button"),t.addEventListener("click",(()=>this.onCancelAction(this.props.cancelAction))),e.querySelector(".box_title_wrap").appendChild(t)}_renderOuter(){return document.querySelector(".vk_app_modal_outer")}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach(((e,t)=>{"deny"===e.type?this.props.buttons[t].action=this.props.cancelAction:this.props.buttons[t].action=this.props.allowAction}))}_renderScopes(e){var t=(0,A.getIcon20CheckBoxOn)().icon,s=(0,E.getIcon20CheckBoxOff)().icon;return e.map(((e,r)=>{var a=getLang(`vkapps_scope_${e}`);return`\n          <div class="scope_row MiniAppModalScope">\n            <input class="blind_label MiniAppModalScope__input" type="checkbox" id="scope_${r}" checked="">\n            <span class="MiniAppModalScope__checkIcon MiniAppModalScope__checkIcon--on">${t}</span>\n            <span class="MiniAppModalScope__checkIcon MiniAppModalScope__checkIcon--off">${s}</span>\n            <label for="scope_${r}">${a}</label>\n          </div>\n        `})).join("\n")}renderModal(){this._enhanceBtnsWithActions(),this.modal=this._renderOuter(),this.modal.innerHTML=`\n  <div class="box_layout vk_app_modal_container">\n    <div class="box_title_wrap">\n       <div class="box_title">${this.props.title}</div>\n    </div>\n    <div class="box_body" style="display: block;">\n      ${this.props.text?`<p>${this.props.text}</p>`:""}\n      ${this.props.scopes&&`<div class="vk_app_modal_scopes">${this._renderScopes(this.props.scopes)}</div>`}\n    </div>\n    <div class="box_controls_wrap" style="display: block;">\n      <div class="box_controls vk_app_modal_btns"></div>\n    </div>\n  </div>\n`,this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this._renderBtns(this.modal)}};class O extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetCommunityToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_community_request_token")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.checkToken=this.checkToken.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.onEditClick=this.onEditClick.bind(this)}scopeList(e){var t=this.app.params.group_whitelist_scopes?e.filter((e=>this.app.params.group_whitelist_scopes.includes(e))):e;return t=t.filter(((e,t,s)=>t===s.indexOf(e)))}checkScopes(e){return 0===e.filter((e=>!this.app.params.group_whitelist_scopes.includes(e))).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new R.UIAction({...this.params.modal,...e,scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick}),this.editScopesModal=new S({...this.params.modal,...e,text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction}),m.default.push(this.modal)}takeAction(e){ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),...this.request,...e},{onDone:e=>{this.handleResponse(e,null,this.checkToken)},onFail:()=>{this.errorHandler({code:h.ERROR_CODES.UNKNOWN})}})}checkToken(e){e.access_token?this.successHandler({...e}):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS})}loadIntroData(e){this.request={...e},ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,...this.request},{onDone:t=>{this.handleResponse(t,e,this.checkIntroData)},onFail:e=>(this.errorHandler({code:h.ERROR_CODES.ACCESS_DENIED}),!0)})}allowUIAction(e){this.takeAction(e),m.default.pop(this.modal)}checkIntroData(e,t){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("scope"))this.successHandler({access_token:e.access_token,scope:e.scope});else if(e.hasOwnProperty("status")){if(!e.hasOwnProperty("group"))return this.errorHandler({code:h.ERROR_CODES.ACCESS_DENIED,reason:h.ERROR_REASONS.USER_IS_NOT_GROUP_ADMIN});e.group.photo_100&&(t.pic=e.group.photo_100),e.group.name&&(t.title=getLang("apps_group_access_request").replace("%s",e.group.name)),this.launchUI({...t,scopes:this.scopeStringToArray(t.scope)})}}handler(e,t,s){if(this.setData(e,t),this.callback=s,this.checkParams(e,[{param:"scope",type:"string",isRequired:!0},{param:"app_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]},{param:"group_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])){var r=this.scopeStringToArray(e.scope);r&&this.checkScopes(r)?(this.params.scope=this.scopeList(r),this.loadIntroData(e)):this.errorHandler({code:h.ERROR_CODES.UNKNOWN,error_type:h.ERROR_TYPES.CLIENT,reason:h.ERROR_REASONS.UNKNOWN_ERROR},s)}}actionHandler(e){this.loadIntroData(e)}}class v extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppAddToCommunity",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_undo"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_community")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.addToCommunitySuccessHandler=this.addToCommunitySuccessHandler.bind(this),this.addToCommunityErrorHandler=this.addToCommunityErrorHandler.bind(this),this.unsetCurHandlers=this.unsetCurHandlers.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.checkAppAdd=this.checkAppAdd.bind(this),this.showConfirmationModal=this.showConfirmationModal.bind(this)}takeAction(){ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,...this.request},{onDone:e=>{this.handleResponse(e,{},this.checkAppAdd)},onFail:e=>(this.errorHandler(e),!0)})}checkAppAdd(e){parseInt(e,10)&&this.successHandler({result:!0})}loadIntroData(e){this.request={...e};var t=(0,n.isMvk)()?{act:"vkapps_add_to_community_box",hash:cur.app.options.hash,app_id:this.app.appId,...this.request}:{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,...this.request};if((0,n.isMvk)()){var{ajax:s}=window;s.post("apps.php",t,{onDone:(e,t)=>{cur.app.showAppsBox(e,t)},onFail:e=>(this.errorHandler(e),!0)})}else ajax.post("apps.php",t,{onDone:e=>{this.handleResponse(e,{},this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e){e.items.length>0?window.showBox("apps",{act:"add_vk_app_to_groups_box",app_id:this.app.appId},{params:{dark:1,width:570,bodyStyle:"padding: 22px 0 0"},onFail:function(e){return window.showFastBox(getLang("global_error"),e),!0}}):0===e.items.length&&(this.errorHandler({code:1}),this.noCommunitiesBox=new window.MessageBox({title:getLang("global_error"),dark:1}).content(getLang("vkapps_no_admin_communities_warning")).addButton(getLang("global_close"),(()=>{this.noCommunitiesBox.hide()})).show())}unsetCurHandlers(){cur.vkAppAddToCommunitySuccessHandler=null,cur.vkAppAddToCommunityErrorHandler=null,cur.vkAppShowModal=null,(0,n.isMvk)()&&VKApps.cancelSettings()}addToCommunitySuccessHandler(e){this.successHandler(e),this.unsetCurHandlers()}addToCommunityErrorHandler(e){this.errorHandler(e||{code:4}),this.unsetCurHandlers()}showConfirmationModal(e){return this.params.modal.checkbox=this._getCheckboxParams(e),this.params.modal.isGradientModal="hidden"!==e,this.params.modal.containerId="apps",new Promise(((e,t)=>{this.params.modal.allowAction=()=>{this.params.modal.checkbox?e(this.params.modal.checkbox[0].checked):e(!1),m.default.pop(this.modal)},this.params.modal.cancelAction=()=>{t(),m.default.pop(this.modal)},this.modal=new R.UIAction(this.params.modal),m.default.push(this.modal)}))}_getCheckboxParams(e){if("hidden"!==e)return[{title:getLang("apps_add_app_to_community_modal_checkbox_title"),description:getLang("apps_add_app_to_community_modal_checkbox_description"),checked:!1,disabled:"disabled"===e}]}handler(e,t,s){this.setData(e,t),this.callback=s,cur.vkAppAddToCommunitySuccessHandler=this.addToCommunitySuccessHandler,cur.vkAppAddToCommunityErrorHandler=this.addToCommunityErrorHandler,cur.vkAppShowModal=this.showConfirmationModal,this.loadIntroData(e)}}class b extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppAddToHomeScreenInfo"}actionHandler(e){this.successHandler({is_feature_supported:!1,is_added_to_home_screen:!1})}}var g=s(53271);class N extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppCopyText"}copyError(){this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:"Can’t copy text on this device"},this.callback)}actionHandler(e){e.text?(0,g.copyToClipboard)(e.text).then((()=>{this.successHandler({result:!0})})).catch((()=>{this.copyError()})):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "text"'})}}var I={CITY:"city",SEX:"sex",COUNTRY:"country",PHOTO_100:"photo_100",PHOTO_200:"photo_200",PHOTO_MAX_ORIG:"photo_max_orig",TIMEZONE:"timezone",BDATE:"bdate",BDATE_VISIBILITY:"bdate_visibility"},k=0,y=2;class C extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetUserInfo"}actionHandler(e){if(this._validateParams(e)){var t={fields:Object.values(I).join(",")};e.user_id&&(t.user_ids=e.user_id),(0,l.api)("users.get",t).then((e=>{0!==e.length?this.successHandler(this._sanitizeResponseData(e[0])):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:h.ERROR_REASONS.INVALID_PARAMS})})).catch((e=>{var t;this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:(null==e||null==(t=e.error)?void 0:t.error_msg)||h.ERROR_REASONS.UNKNOWN_ERROR})}))}}_sanitizeResponseData(e){var t={...e};if(e[I.BDATE_VISIBILITY]===k)delete t[I.BDATE];else if(e[I.BDATE_VISIBILITY]===y){var s=e[I.BDATE].split(".");3===s.length&&(t[I.BDATE]=s.slice(0,2).join("."))}return t}_validateParams(e){return this.checkParams(e,[{param:"user_id",type:"number",extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])}}class w extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppSetLocation"}actionHandler(e){e.hasOwnProperty("location")?"string"==typeof e.location?((0,n.isMvk)()?nav.set({replace:!0,nav:{push:location.pathname+location.search+"#"+e.location,path:location.pathname,hash:"#"+e.location}}):e.replace_state?history.replaceState(null,null,`#${e.location}`):cur.app.funcs.setLocation(e.location),dr({handler:i.CONNECT_EVENTS.LOCATION_CHANGED,params:{location:e.location}},this.app),this.successHandler({result:!0})):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "location" should be a string'}):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "location"'})}}class f extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetClientVersion"}actionHandler(e){var t=h.PLATFORM.WEB;(0,n.isMvk)()&&(t=h.PLATFORM.MOBILE_WEB),this.successHandler({platform:t,version:"0.0"},this.callback)}}class P extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetPhoneNumber",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_phone"),text:getLang("apps_connect_modal_messages_request_phone_text")},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request={...e},ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${h.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:h.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var s=JSON.parse(t);this.checkIntroData(s,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.hasOwnProperty("phone_number")&&e.sign?this.successHandler(e):this.launchUI(t)}handler(e,t,s){this.setData(e,t),this.callback=s,this.loadIntroData()}}class T extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetEmail",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_email"),text:getLang("apps_connect_modal_messages_request_email_text")},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request={...e},ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${h.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:h.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var s=JSON.parse(t);this.checkIntroData(s,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.hasOwnProperty("email")&&e.sign?this.successHandler(e):this.launchUI(t)}handler(e,t,s){this.setData(e,t),this.callback=s,this.loadIntroData()}}class H extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetGeodata",this.callApi=!0,this.useUI=!1,this.timeoutFails=0,this.options={maximumAge:0,timeout:2e3},this.geodataSuccess=this.geodataSuccess.bind(this),this.geodataFail=this.geodataFail.bind(this)}get successDescriptor(){return"VKWebAppGeodataResult"}get errorDescriptor(){return"VKWebAppGeodataFailed"}geodataSuccess(e){var{longitude:t,latitude:s,accuracy:r}=e.coords;this.successHandler({available:1,lat:s,long:t,accuracy:r},this.callback)}geodataFail(e){switch(e.code){case 3:this.timeoutFails++,this.timeoutFails<2?navigator.geolocation.getCurrentPosition(this.geodataSuccess,this.geodataFail,this.options):this.successHandler({available:0},this.callback);break;case 2:this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:"Device can't get geodata"},this.callback);break;case 1:this.errorHandler({code:h.ERROR_CODES.USER_DENIED,reason:"User didn't allowed"},this.callback)}}actionHandler(e){if(!this.callApi)return{};navigator.geolocation.getCurrentPosition(this.geodataSuccess,this.geodataFail,this.options)}}class D extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppOpenQR"}actionHandler(e){this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class L extends a.Handler{constructor(e){super(e);var t=getLang("apps_connect_modal_messages_send_install_push");this.params.handlerName="VKWebAppSendToClient",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:t.replace("{app_name}",cur.app.options.app_name)},this.callApi=!0,this.useUI=!0}handler(e,t,s){this.setData(e,t),this.props=e,this.callback=s,this.loadIntroData()}loadIntroData(e){ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},{onDone:t=>{var s=JSON.parse(t);this.checkIntroData(s,e)},onFail:()=>{this.sendNetworkError()}})}checkIntroData(e,t){e.result?this.actionHandler():this.launchUI(t)}actionHandler(){return new Promise(((e,t)=>{ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,group_id:this.props.group_id,fragment:this.props.fragment,al:1,cid:0,ref:0},{onDone:t=>{e(t)},onFail:e=>{t(e)}})})).then((()=>{this.successHandler({result:!0})})).catch((()=>{this.sendNetworkError()}))}}class M extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppSetViewSettings"}actionHandler(e){this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class V extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppSetTitle"}handler(e,t,s){if(this.setData(e,t),this.callback=s,this.app.isTextliveApp){if(!this.checkParams(e,[{param:"title",type:"string",isRequired:!0}]))return;window.setDocumentTitle(e.title)}else this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM},s)}}var W=s(28412);class x extends a.Handler{constructor(e){super(e);var t=cur.app.isDirectGame?getLang("vkapps_connect_modal_game_request_token"):getLang("apps_connect_modal_messages_request_token_var");this.params.handlerName="VKWebAppGetAuthToken",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:t.replace("{app_name}",cur.app.options.app_name)},this.callApi=!0,this.useUI=!0,this.onEditClick=this.onEditClick.bind(this)}get successDescriptor(){return"VKWebAppAccessTokenReceived"}get errorDescriptor(){return"VKWebAppAccessTokenFailed"}scopeList(e){var t=this.app.params.whitelist_scopes?e.filter((e=>~this.app.params.whitelist_scopes.indexOf(e))):e;return t=t.filter(((e,t,s)=>t===s.indexOf(e)))}checkScopes(e){return 0===e.filter((e=>!this.app.params.whitelist_scopes.includes(e))).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new R.UIAction({...this.params.modal,...e,scopes:this.params.scope,showCloseBtn:!0,extraAction:this.onEditClick});var t=cur.app.isDirectGame?getLang("vkapps_connect_modal_game_request_token_available_title"):getLang("apps_connect_modal_messages_scopes_available");this.editScopesModal=new S({...this.params.modal,...e,text:t,scopes:this.params.scope,showCloseBtn:!0,allowUIAction:this.allowUIAction}),m.default.push(this.modal)}actionHandler(e){return this.callApi?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${h.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:h.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId,...e},{onDone:e=>{if(e.hasOwnProperty("error"))this.errorHandler(e.error);else try{var t=JSON.parse(e);t.access_token?this.successHandler({...t}):this.errorHandler({reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)}):{}}loadIntroData(e){this.request={...e},this.app.appId===e.app_id?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${h.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:h.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId,scope:e.scope},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var s=JSON.parse(t);this.checkIntroData(s,e)}catch(e){console.log(e),this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)}):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:"Wrong app id"})}checkIntroData(e,t){if(e.status){var s={};e.access_token&&(s.access_token=e.access_token),s.scope=this.params.scope.join(","),this.successHandler(s)}else this.launchUI(t)}handler(e,t,s){if(this.setData(e,t),e&&Array.isArray(e.scope)&&(e.scope=e.scope.join(",")),e&&e.text&&(e.text=(0,W.encodeHTMLEntities)((0,W.escape)(e.text))),this.callback=s,e.scope||""===e.scope)if("string"==typeof e.scope)if(e.app_id)if("number"==typeof e.app_id){var r=this.scopeStringToArray(e.scope);r&&this.checkScopes(r)?(this.params.scope=this.scopeList(r),this.loadIntroData(e)):this.errorHandler({code:h.ERROR_CODES.UNKNOWN,error_type:h.ERROR_TYPES.CLIENT,reason:h.ERROR_REASONS.UNKNOWN_ERROR},s)}else this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Param "app_id" should be a number'},s);else this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},s);else this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Param "scope" should be a string'},s);else this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "scope"'},s)}}var K=s(63533),U=s(19331);class F extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppCallAPIMethod",this.params.v="5.85",this.params.method=null,this.resolveResponse=this.resolveResponse.bind(this)}actionHandler(e){var t={...e.params};e.request_id&&(t.request_id=e.request_id),function(e,t,s,r,a){if(s||(s={}),delete s.callback,t)if(s.hasOwnProperty("access_token")){Object.keys(s).forEach((e=>{"object"==typeof s[e]&&(s[e]=JSON.stringify(s[e]))}));var i={api_id:e.appId,method:t,format:"json",v:h.API_VERSION,...s},n=(0,K.objectToQuerystring)(i),o=new XMLHttpRequest,p=(0,U.partConfigEnabled)("mini_apps_web_call_api_form_data")&&6911063!==parseInt(e.appId,10);p?(o.open("POST",`https://${e.apiHost}/method/${t}`),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded")):o.open("POST",`https://${e.apiHost}/method/${t}${n}`),o.onload=()=>{if(200==o.status)try{var e=JSON.parse(o.response);s.request_id&&(e.request_id=s.request_id),e.hasOwnProperty("error")?a({reason:e.error}):r(e)}catch(e){a({code:1,reason:e.message})}else a({reason:o.statusText})},o.onerror=()=>{a({code:h.ERROR_CODES.UNKNOWN,error_type:h.ERROR_TYPES.CLIENT,reason:h.ERROR_REASONS.NETWORK_ERROR})},p?o.send(n):o.send()}else a({code:h.ERROR_CODES.MISSING_PARAM,reason:"Missing required param access_token"});else a({code:h.ERROR_CODES.MISSING_PARAM,reason:"Missing required param method"})}({appId:this.app.appId,apiHost:this.app.apiHost},e.method,t,this.successHandler,this.errorHandler)}resolveResponse(e){e&&(e.hasOwnProperty("error")?this.errorHandler(e.error):this.successHandler(e))}handler(e,t,s){this.callback=s,this.setData(e,t),e.params?e.params.v||e.params.version?isNaN(parseInt(e.params.v,10))&&isNaN(parseInt(e.params.version,10))?this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "v" should be a number'},s):(e.params.hasOwnProperty("v")?this.params.v=e.params.v:e.params.hasOwnProperty("version")&&(this.params.v=e.params.version),this.actionHandler(e)):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "v"'},s):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:"Missing required params"},s)}}class B extends a.Handler{constructor(e){super(e),this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this)}takeAction(){var e,t,s;this.request.intents=[],null==(e=this.params)||null==(t=e.modal)||null==(s=t.checkbox)||s.map((e=>e.name&&this.request.intents.push(e.name))),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,...this.request},{onDone:e=>{e.hasOwnProperty("error")?this.errorHandler(e.error):parseInt(e,10)?this.successHandler({result:!0}):this.errorHandler()},onFail:e=>(this.errorHandler(e),!0)})}loadIntroData(e){this.request={...e},ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,...this.request},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var s=JSON.parse(t),r=s.group.is_closed;this.checkIntroData({isGroupMember:s.is_group_member,canJoin:r!==h.GROUP_STATUS.PRIVATE,can_send_messages:s.can_send_messages,...s.group},e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),m.default.pop(this.modal)}checkIntroData(e,t){this.params.modal.pic=e.photo_100,this.params.modal.app_name=e.name,this.params.modal.subscribers=e.members_count>1e3?Math.ceil(e.members_count/1e3):e.members_count,this.params.modal.title=e.name,this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions()}handler(e,t,s){this.setData(e,t),this.callback=s,e.group_id?"number"==typeof e.group_id?this.loadIntroData(e):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" should be a number'},this.callback):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Param "group_id" is missing'},this.callback)}actionHandler(e){this.loadIntroData(e)}}class G extends B{constructor(e){super(e),this.params.handlerName="VKWebAppJoinGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_subscribe"),type:"success"}],text:getLang("apps_connect_modal_messages_join_group_text"),showCloseBtn:!0}}checkIntroData(e,t){super.checkIntroData(e,t),e.isGroupMember?this.successHandler({result:!0}):e.canJoin?(this.modal=new R.UIAction({...this.params.modal}),m.default.push(this.modal)):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:h.ERROR_REASONS.INVALID_PARAMS})}}class q extends B{constructor(e){super(e),this.params.handlerName="VKWebAppLeaveGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_leave"),type:"success"}],text:getLang("apps_connect_modal_messages_leave_group_text"),showCloseBtn:!0}}checkIntroData(e,t){super.checkIntroData(e,t),e.isGroupMember?(this.modal=new R.UIAction({...this.params.modal}),m.default.push(this.modal)):this.successHandler({result:!0})}}class $ extends B{constructor(e){super(e),this.params.handlerName="VKWebAppAllowMessagesFromGroup",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],text:getLang("apps_connect_modal_messages_allow_messages_text"),title:getLang("apps_connect_modal_messages_allow_messages_title")}}checkIntroData(e,t){super.checkIntroData(e,t);var s=this.params.modal;if(e.can_send_messages)this.successHandler({result:!0});else{if(s.text=s.text.replace("{group_name}",e.name),(0,U.partConfigEnabled)("mini_apps_allow_messages_from_groups_intents")){if(!this.checkParams(t,[{param:"intents",type:"object"},{param:"subscribe_id",type:"array"}]))return;var r=Array.from(new Set(t.intents));if(r){var a={[h.PROMO_NEWSLETTER_INTENT]:{name:h.PROMO_NEWSLETTER_INTENT,title:getLang("apps_intents_promo_newsletter_title"),description:getLang("apps_intents_promo_newsletter_description")},[h.NON_PROMO_NEWSLETTER_INTENT]:{name:h.NON_PROMO_NEWSLETTER_INTENT,title:getLang("apps_intents_promo_non_newsletter_title"),description:getLang("apps_intents_promo_non_newsletter_description")},[h.CONFIRMED_NOTIFICATION_INTENT]:{name:h.CONFIRMED_NOTIFICATION_INTENT,title:getLang("apps_intents_confirmed_notification_title"),description:getLang("apps_intents_confirmed_notification_description")}},[i,o]=s.buttons;(0,n.isMvk)()&&(s.buttons.reverse(),s.isGradientModal=!0,s.isNoWrapButtons=!0),i.title=getLang("apps_connect_modal_btn_undo"),o.title=getLang("apps_connect_modal_btn_allow_selected"),s.checkbox=s.checkbox||[],r.forEach((e=>{a[e]&&s.checkbox.push(a[e])})),r.length>0&&s.checkbox.unshift({title:getLang("apps_intents_developments_in_apps"),checked:!0,disabled:!0})}}this.modal=new R.UIAction({...s}),m.default.push(this.modal)}}}class j extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppDenyNotifications",this.callApi=!0,this.useUI=!1}}class Y extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppOpenPayForm",this.checkTransaction=this.checkTransaction.bind(this),this.destroyVkPayContainer=this.destroyVkPayContainer.bind(this)}actionHandler(e){this.app.isMiniAppWidget?this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenPayForm from widget"}):e.action?"string"==typeof e.action?e.params?e.hasOwnProperty("app_id")&&"number"!=typeof e.app_id?this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'"app_id" param should be an integer number'}):window.cur&&window.cur.app&&window.cur.app.isDirectGame?this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:"This event supported only for services"}):super.actionHandler(e):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "params"'}):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Param "action" should be a string'}):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "action"'})}openPayApp(e){var t={...e.params};t.action=e.action;cur.app.funcs.openExternalApp("miniapps_vkpay",t,this.errorHandler)}checkTransaction(e){var t=!(0,n.isMvk)()||e.origin===location.origin;e.data&&"vk-connect"===e.data.type?e.data.handler===h.VKPAY_TRANSACTION_EVENT&&t&&(e.data.params.status?this.successHandler({...e.data.params},this.callback):this.errorHandler({code:h.ERROR_CODES.USER_DENIED,reason:h.ERROR_REASONS.USER_DENIED}),(0,n.isMvk)()||this.destroyVkPayContainer()):e.data&&e.data.externalAppClosed&&this.errorHandler({code:h.ERROR_CODES.USER_DENIED,reason:h.ERROR_REASONS.USER_DENIED})}destroyVkPayContainer(){window.removeEventListener("message",this.checkTransaction)}launchVkPayContainer(e){this.openPayApp(e),window.addEventListener("message",this.checkTransaction)}checkResponse(e,t){e?this.launchVkPayContainer(t):this.errorHandler({code:h.ERROR_CODES.ACCESS_DENIED,reason:h.ERROR_REASONS.VK_PAY_DISABLED,error_type:h.ERROR_TYPES.CLIENT})}}class J extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppAllowNotifications",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_allow_notifications_title"),text:getLang("apps_connect_modal_messages_allow_notifications_text")},this.callApi=!0,this.useUI=!0}takeAction(){var e={group_id:this.request.group_id};this.request.hasOwnProperty("key")&&(e.key=this.request.key),ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,...e},{onDone:e=>{this.handleResponse(e,{},(e=>this.successHandler(e)))},onFail:e=>(this.errorHandler(e),!0)})}loadIntroData(e){this.request={...e},ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var s=JSON.parse(t);this.checkIntroData({can_send_messages:s.can_send_messages,...s.group},e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}allowUIAction(e){this.takeAction(e),m.default.pop(this.modal)}checkIntroData(e,t){e.can_send_messages?this.successHandler({result:!0}):(this.params.modal.pic="/images/vk-app-notification.png",this.params.modal.picClass="MiniAppModalContainer__pic--small",this.params.modal.app_name=e.name,this.createDenyUIAction(),this.createAllowUIAction(t),this._enhanceBtnsWithActions(),this.modal=new R.UIAction({...this.params.modal}),m.default.push(this.modal))}handler(e,t,s){this.setData(e,t),this.callback=s,this.loadIntroData(e)}}class z extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppOpenApp"}actionHandler(e){if(this.app.appId!==e.app_id||(0,K.isVKPayApp)(parseInt(this.app.appId,10))){var t={open_app_id:e.app_id};this.openAppId=e.app_id,e.location&&(t.location=e.location),this.openApp={...t},ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,...t},{onDone:t=>{try{var s=JSON.parse(t);s.hasOwnProperty("original_url")?(this.successHandler({result:!0}),(0,n.isMvk)()?cur.app.openAppInLayer(s.original_url,!0):(cur.app.openAppInLayer(s.original_url,(()=>(0,K.destroyOpenedApp)(e.app_id))),cur.miniAppOpener||(cur.miniAppOpener=this.app))):s.hasOwnProperty("error")&&this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}else this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:"Same app id as origin"})}handler(e,t,s){this.setData(e,t),this.callback=s,this.app.isMiniAppWidget?this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenApp from widget"},s):e.app_id?"number"==typeof e.app_id?e.hasOwnProperty("location")&&"string"!=typeof e.location?this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'"location" param should be a string'},s):this.actionHandler(e):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "app_id" should be a number'},s):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},s)}createUrl(e){return`app${e.app_id}${e.hasOwnProperty("location")?`#${e.location}`:""}`}}class Q extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShare",this.appId=cur.app.params.api_id,this.userId=cur.app.params.viewer_id}successHandler(e){super.successHandler([e])}actionHandler(e){if(e.link&&"string"!=typeof e.link)this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "link" should be a string'},this.callback);else if((0,n.isMvk)())this.handleMvk(e);else{var t=String(e.link);if(null==t?void 0:t.startsWith(`https://${(0,n.getHostName)()}/textlive`))this.shareTextlive(t);else{if(t){var s={attachments:t,message:t};return(0,U.partConfigEnabled)("apps_app_share_vk_bridge_event_disable_double_test_and_link")&&delete s.message,void cur.app.funcs.showWallPostBox(s,this.successHandler,this.errorHandler)}this.shareEmitters(),this.share(this.appId,this.userId)}}}handleMvk(e){this.shareEmitters(),e.link?cur.app.funcs.shareBox(e.link,"","","",this.successHandler,this.errorHandler):cur.app.funcs.shareBox(`https://${(0,n.getHostName)()}/app${cur.aid}`,cur.appShareParams.sharePhoto,cur.appShareParams.shareTitle,cur.appShareParams.shareDesc,this.successHandler,this.errorHandler)}share(e,t){window.showBox("like.php",{act:"publish_box",object:"app"+e+"_"+t},{onFail:()=>{this.errorHandler({code:h.ERROR_CODES.UNKNOWN},this.callback)},params:{onHide:()=>{setTimeout((()=>{cur.app.vkMiniAppShareSuccess&&this.errorHandler({code:h.ERROR_CODES.USER_DENIED},this.callback)}),1e3)}}})}shareTextlive(e){var t="";t=e.includes("post_id")?e.replace(/(.*)textlive(\d+)(.*)=(\d+)/i,"textpost$2_$4"):e.replace(/(.*)textlive(\d+)(.*)/i,"textlive$2_0"),window.showBox("like.php",{act:"publish_box",object:t},{onFail:()=>{this.errorHandler({code:h.ERROR_CODES.UNKNOWN},this.callback)},params:{onHide:()=>{setTimeout((()=>{cur.app.vkMiniAppShareSuccess&&this.errorHandler({code:h.ERROR_CODES.USER_DENIED},this.callback)}),1e3)}}})}cleanEmitters(){cur.app.vkMiniAppShareSuccess=null,cur.app.vkMiniAppShareFail=null}shareEmitters(){cur.app.vkMiniAppShareSuccess=e=>{e.post_id?this.successHandler({type:"post",post_id:`${e.owner_id}_${e.post_id}`}):"number"==typeof e&&this.successHandler({type:"message"}),this.cleanEmitters()},cur.app.vkMiniAppShareFail=e=>{e?this.errorHandler(e):this.errorHandler({code:h.ERROR_CODES.USER_DENIED}),this.cleanEmitters()}}}class X extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowNewPostBox",this.appId=cur.app.params.api_id,this.userId=cur.app.params.viewer_id,this.isWebOnly=!0}checkFields(e){return this.checkParams(e,[{param:"owner_id",type:"number"},{param:"author_id",type:"number"},{param:"textlive_id",type:"number",isRequired:!1,extraChecks:[{check:()=>h.TEXTLIVE_APPS.includes(cur.app.params.api_id),error:()=>h.ERROR_REASONS.UNKNOWN_ERROR}]},{params:"situational_suggest_id",type:"number"},{params:"post",type:"object"}])}actionHandler(e){this.checkFields(e)&&this.open(e)}open(e){this.initEmitters(),cur.getWkviewOpts=()=>({textlive_id:e.textlive_id,author_id:e.author_id,owner_id:e.owner_id,textpost_id:e.post?e.post.id:0,situational_suggest_id:e.situational_suggest_id,post:JSON.stringify(e.post)}),window.showWiki({w:"postbox"},null,null,{queue:1})}cleanEmitters(){cur.app.vkMiniAppNewPostSuccess=null,cur.app.vkMiniAppNewPostFail=null}initEmitters(){window.cur.app.vkMiniAppNewPostSuccess=e=>{e.post_id?this.successHandler({type:"post",post_id:`${e.owner_id}_${e.post_id}`}):"number"==typeof e&&this.successHandler({type:"message"}),this.cleanEmitters()},window.cur.app.vkMiniAppNewPostFail=e=>{e?this.errorHandler(e):this.errorHandler({error_type:"client_error",code:h.ERROR_CODES.USER_DENIED}),this.cleanEmitters()}}}class Z extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowWallPostBox",this.externalSuccessHandler=this.externalSuccessHandler.bind(this),this.externalErrorHandler=this.externalErrorHandler.bind(this),this.setExternalHandlers()}setExternalHandlers(){cur.VKWebAppShowWallPostBoxErrorHandler=this.externalErrorHandler,cur.VKWebAppShowWallPostBoxSuccessHandler=this.externalSuccessHandler}unsetCurHandlers(){cur.VKWebAppShowWallPostBoxErrorHandler=null,cur.VKWebAppShowWallPostBoxSuccessHandler=null,(0,n.isMvk)()&&VKApps.cancelSettings()}externalSuccessHandler(e){e&&e[1]?this.successHandler({post_id:e[1]}):this.errorHandler(),this.unsetCurHandlers()}externalErrorHandler(){this.errorHandler({code:h.ERROR_CODES.USER_DENIED,reason:"User denied"}),this.unsetCurHandlers()}actionHandler(e){e.hasOwnProperty("message")?e.message&&"string"!=typeof e.message?this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "message" should be a string'},this.callback):(e.message=e.message.replace(/(\r)/g,""),cur.app.funcs.showWallPostBox(e,this.successHandler.bind(this),this.errorHandler.bind(this))):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "message"'})}}class ee extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppScroll",this.useUI=!1,this.isWebOnly=!0,this.DEFAULT_SPEED=100,this.onScrollEnd=this.onScrollEnd.bind(this)}onScrollEnd(){this.successHandler({result:{top:this.params.data.top,height:document.documentElement.offsetHeight}})}checkFields(e){return this.checkParams(e,[{param:"top",type:"number",isRequired:!0},{param:"speed",type:"number"}])}actionHandler(e){if(this.checkFields(e)){var t=e.hasOwnProperty("speed")?e.speed:this.DEFAULT_SPEED;if(this.params.data={top:e.top},~this.app.containerId.indexOf("layer")){var s=document.querySelector("#wk_layer_wrap");s?s.scrollTop=e.top:this.errorHandler({code:h.ERROR_CODES.UNKNOWN,error_type:h.ERROR_TYPES.CLIENT,reason:h.ERROR_REASONS.UNKNOWN_ERROR})}else this.scroll=new class{constructor(e,t,s){this.desiredOffset=e,this.speed=t,this.onComplete=s}go(){window.Apps.scrollToY(this.desiredOffset,this.speed,void 0,void 0,this.onComplete)}}(e.top,t,this.onScrollEnd.bind(this)),this.scroll.go()}}}class te extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppResizeWindow",this.useUI=!1,this.isWebOnly=!0}setWidth(e){var t,s,r=165;e&&this.app.vkApp&&(e=Math.min(Math.max(e,607),1e3),this.app.vkApp.options.layout_width&&(r=this.app.vkApp.options.layout_width-e),(null==(t=cur.app)||null==(s=t.options)?void 0:s.layer)?WkView.onResize():window.handlePageView&&window.handlePageView({noleftmenu:vk.noleftmenu,nobottommenu:vk.nobottommenu,notopmenu:vk.notopmenu,body_class:vk.body_class,staticheader:vk.staticheader,no_ads:vk.no_ads,ad_preview:vk.ad_preview,top_home_link_class:vk.top_home_link_class,width:Math.max(e,607)+r}),cur.app.frame.style.width=cur.app.cont.style.width=e+"px",this.result.width=e)}setHeight(e){var t,s,r,a,i,n,o,p,c,d=500;if(e){this.app.isTextliveApp&&(d=0),e=Math.min(Math.max(e,d),1e4);var l=null==(t=this.app.vkApp)||null==(s=t.params)?void 0:s.is_vkpay_service;(null==(r=this.app.vkApp)?void 0:r.params)||(l=cur.app.options.is_vkpay_app),!l&&this.app.vkApp.inlineApp&&e>this.app.vkApp.options.heightMax&&(e=this.app.vkApp.options.heightMax);var h=e+"px";cur.app.frame.style.height=h,(null==(a=this.app.vkApp)||null==(i=a.options)?void 0:i.boxed)||(cur.app.cont.style.height=h),(null==(n=cur.app)||null==(o=n.options)?void 0:o.layer)&&WkView.onResize(),(null==(p=this.app.vkApp)||null==(c=p.options)?void 0:c.onResize)&&this.app.vkApp.options.onResize(),this.result.height=e}}checkFields(e){return this.checkParams(e,[{param:"width",type:"number"},{param:"height",type:"number"}])}actionHandler(e){this.checkFields(e)&&(e.hasOwnProperty("height")||e.hasOwnProperty("width")?(this.result={},e.hasOwnProperty("width")&&this.setWidth(e.width),e.hasOwnProperty("height")&&this.setHeight(e.height),this.successHandler({result:{...this.result}})):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:"At least one parameter is required"}))}}class se extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppSendPayload",this.callApi=!0,this.useUI=!1}handler(e,t,s){if(this.setData(e,t),this.callback=s,e.group_id)if("number"==typeof e.group_id)if(e.hasOwnProperty("payload")&&"object"!=typeof e.payload)this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'"payload" param should be an object'},s);else{try{e.payload=JSON.stringify(e.payload)}catch(e){this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "payload" is not valid JSON object'},s)}this.actionHandler(e)}else this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "group_id" should be a number'},s);else this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "group_id"'},s)}actionHandler(e){return ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${h.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:h.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId,...e},{onDone:t=>{try{var s=JSON.parse(t);s.hasOwnProperty("error")?this.errorHandler(s.error,this.callback,h.ERROR_TYPES.API):s.status?this.successHandler({...s,scope:e.scope}):this.errorHandler({reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}}var re=(0,n.getHostName)().replace(".","\\."),ae=new RegExp(`^https://(?:(?:.*).)*${re}(/@[a-z0-9_-]+)$`,"im");class ie extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppOpenArticle",this.callApi=!1,this.useUI=!0}launchUI(e){var{url:t=""}=e,s=t.match(ae);if(s&&s[1]){var r=s[1];if((0,n.isMvk)()){var a=window.location.pathname.substr(1);window.nav.go(`${r}?from=${a}`)}else window.show(boxLoader),window.show(boxLayerWrap),window.boxRefreshCoords(boxLoader),window.articlePrepare(r,{onEducationCloseBtnClick:e=>this.successReadHandler(e),onFailCallBack:()=>{window.hide(boxLoader),window.hide(boxLayerWrap),this.errorHandler({code:h.ERROR_CODES.UNKNOWN,error_type:h.ERROR_TYPES.CLIENT,reason:"ServerError: Can't open article."})}},(()=>{window.hide(boxLoader),window.hide(boxLayerWrap),window.nav.go(r),this.successHandler({result:!0})}))}else this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:`Error: incorrect url: ${t}`})}successReadHandler(e){this.callback({type:"VKWebAppArticleClosed",data:e},this.params.handlerName),(0,n.isMvk)()&&cur.app.frame.focus()}}var ne=s(16550);class oe extends a.Handler{constructor(e){super(e),this.params.handlerName=i.CONNECT_EVENTS.UPDATE_CONFIG}get successDescriptor(){return this.params.handlerName}actionHandler(){this.successHandler((0,ne.getSchemeConfig)())}}class pe extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppTapticImpactOccurred"}actionHandler(e){this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class ce extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppTapticNotificationOccurred"}actionHandler(e){this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class de extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppTapticSelectionChanged"}actionHandler(e){this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class le extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowImages",this.isMobileWebOnly=!0}checkUrlString(e){try{return!!new URL(e)}catch{return!1}}handler(e,t,s){this.setData(e,t),this.callback=s;var r=e.start_index,a=e.images;if(this.checkParams(e,[{param:"images",type:"object",isRequired:!0,extraChecks:[{check:e=>e.every((e=>this.checkUrlString(e))),error:e=>`Param "${e}" should be a valid link.`},{check:e=>e.every((e=>e.startsWith("https://"))),error:e=>`Param "${e}" should be https link.`}]},{param:"start_index",type:"number",extraChecks:[{check:e=>e>=0,error:e=>`Param "${e}" should be non-negative number.`},{check:e=>void 0!==a[e],error:e=>`Param "${e}" should be a valid index in the pictures array.`}]}])){var i=r||0;window.photo.openExternal(a,i),this.successHandler({result:!0})}}}var he=s(94105),_e=s(29853);class ue extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowLeaderBoardBox",this.callApi=!0,this.isMobileWebOnly=!0}actionHandler(e){super.actionHandler(e)}handleResponse(e,t){if((e=JSON.parse(e)).hasOwnProperty("error"))this.errorHandler({reason:h.ERROR_REASONS.UNKNOWN_ERROR,description:e.error});else{var s={...t,...e};window.DirectGames.showLeaderBoard({onClose:()=>{this.successHandler({result:!0})},board:s})}}}class me extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowInviteBox"}handler(e,t,s){if(this.inProgress)return this.sendCustomError(h.ERROR_REASONS.ALREADY_IN_PROGRESS);this.inProgress=!0,this.setData(e,t),this.callback=s,this.callApi=!0,e.friend_id?this.processSingleInvite(e):this.processMultiInvite(e)}processSingleInvite(e){this.useUI=!0,this.pic="",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_invite_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_invite_ok"),type:"success"}],showCloseBtn:!0,title:""},this.loadSingleInviteIntroData(e)}processMultiInvite(){this.useUI=!1,this.params.modal=null,this.multiInviteHandler()}multiInviteHandler(){(0,n.isMvk)()?window.DirectGames.showInviteBox({onSuccess:e=>{this.isLoading=!1,super.actionHandler(e)},onFail:e=>{this.isLoading=!1,this.errorHandler(e)}}):cur.app.funcs.showInviteBox((e=>{this.isLoading=!1,this.successHandler(e)}),(e=>{this.isLoading=!1,this.errorHandler(e)}))}loadSingleInviteIntroData(e){if(this.checkParams(e,[{param:"friend_id",type:"number",isRequired:!0}])){this.request={...e};var{friend_id:t}=e,s={app_id:this.app.appId,user_id:t};(0,l.api)("apps.checkInviteFriend",s).then((({text:t,photo:s,request_id:r})=>{var a={text:t,photo:s};r&&(a.payload=r),this.checkSingleInviteIntroData(a,e)})).catch((e=>{this.handleApiError(e)}))}}checkSingleInviteIntroData(e,t){t.text=e.text,t.pic=e.photo.url,this.launchUI(t)}allowUIAction(e){this.trySendSingleInvite(this.request.friend_id),m.default.pop(this.modal)}trySendSingleInvite(e){(0,l.api)("apps.inviteFriend",{app_id:this.app.appId,user_id:e}).then((()=>{this.isLoading=!1,this.successHandler({result:!0})})).catch((e=>{this.isLoading=!1,this.handleApiError(e)}))}}class Re extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppOpenArticleEditor",this.callApi=!1,this.useUI=!0,this.launchUI=this.launchUI.bind(this)}launchUI(e){if(cur.app.params.open_article_edit&&!window.isMvk){var{owner_id:t,article_id:s,course_id:r}=e,a="number"==typeof t,i="number"==typeof s,n="number"==typeof r;t&&a?s&&!i?this.errorHandler({code:i?h.ERROR_CODES.MISSING_PARAM:h.ERROR_CODES.INVALID_PARAMS,reason:`Param "article_id" is wrong. Expected integer greater than 0, got type ${typeof s} with value ${s}.`}):r&&(!n||r<=0)?this.errorHandler({code:n?h.ERROR_CODES.MISSING_PARAM:h.ERROR_CODES.INVALID_PARAMS,reason:`Param "course_id" is wrong. Expected integer greater than 0, got type ${typeof r} with value ${r}.`}):window.openArticleEditor&&window.openArticleEditor(t,s,null,{course_id:r,is_education:r>0?1:0,app_id:this.app.appId,app_hash:this.getEventHash()},{from:"app",eventHandler:this.successHandler.bind(this),errorHandler:this.errorWrapper.bind(this)}):this.errorHandler({code:a?h.ERROR_CODES.MISSING_PARAM:h.ERROR_CODES.INVALID_PARAMS,reason:`Param "owner_id" is missing or wrong. Expected integer, got type ${typeof t} with value ${t}.`})}else this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:window.isMvk?"ClientError: This handler is forbidden on this platform":"ClientError: This app isn't allowed to use this handler"})}errorWrapper(e){this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:e})}}class Ee extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowRequestBox",this.callApi=!0}actionHandler(e){e.message&&e.message.trim()&&e.uid?e.message.length>1e3?this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:"The message parameter is longer than the specified length (1000 characters)"}):(0,n.isMvk)()?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,friend_id:e.uid},{onDone:t=>{try{(t=JSON.parse(t)).hasOwnProperty("error")?this.errorHandler({code:t.error.code,reason:t.error.reason},null,h.ERROR_TYPES.API):(Object.assign(e,t),window.DirectGames.showRequestBox({...e,onSuccess:super.actionHandler.bind(this),onFail:this.errorHandler}))}catch(e){this.errorHandler(e)}},onFail:()=>{this.errorHandler({code:h.ERROR_CODES.CONNECTION_LOST,reason:h.ERROR_REASONS.NETWORK_ERROR})}}):(cur.app.registerVkBridgeCallback("onRequestFail",(e=>{(0,o.isObject)(e)?this.errorHandler({code:h.ERROR_CODES.CONNECTION_LOST,reason:h.ERROR_REASONS.NETWORK_ERROR}):this.errorHandler({code:h.ERROR_CODES.UNKNOWN,reason:e},null,h.ERROR_TYPES.API)})),cur.app.registerVkBridgeCallback("onRequestCancel",(()=>{this.errorHandler({reason:h.ERROR_REASONS.USER_DENIED,code:h.ERROR_CODES.USER_DENIED})})),cur.app.registerVkBridgeCallback("onRequestSuccess",(()=>{this.successHandler({request_key:e.requestKey,success:!0})})),cur.app.funcs.showRequestBox(e.uid,e.message,e.requestKey)):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:h.ERROR_REASONS.INVALID_PARAMS})}}class Ae extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppStorageGetKeys",this.callApi=!0,this.useUI=!1}handler(e,t,s){this.setData(e,t),this.callback=s,e.hasOwnProperty("count")&&"number"!=typeof e.count?this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "count" should be a number'},s):e.hasOwnProperty("offset")&&"number"!=typeof e.offset?this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "offset" should be a number'},s):e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},s):(e.global=e.global?1:0,this.actionHandler(e))}actionHandler(e){return ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${h.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:h.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId,...e},{onDone:t=>{this.handleResponse(t,e,(e=>this.successHandler(e)))},onFail:e=>{this.errorHandler(e)}})}}class Se extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppStorageSet",this.callApi=!0,this.useUI=!1}handler(e,t,s){this.setData(e,t),this.callback=s,e.key?"string"==typeof e.key?e.hasOwnProperty("value")&&"string"!=typeof e.value?this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "value" should be a string'},s):e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},s):(e.global=e.global?1:0,this.actionHandler(e)):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "key" should be a string'},s):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "key"'},s)}actionHandler(e){return ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${h.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:h.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId,...e},{onDone:t=>{this.handleResponse(t,e,(e=>this.successHandler(e)))},onFail:e=>{this.errorHandler(e)}})}}class Oe extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppStorageGet",this.callApi=!0,this.useUI=!1}handler(e,t,s){this.setData(e,t),this.callback=s,e.keys?"object"==typeof e.keys?e.hasOwnProperty("global")&&"boolean"!=typeof e.global?this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "global" should be a boolean'},s):(e.global=e.global?1:0,this.actionHandler(e)):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "keys" should be a string'},s):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "keys"'},s)}actionHandler(e){return ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${h.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:h.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId,...e},{onDone:t=>{this.handleResponse(t,e,(e=>this.successHandler(e)))},onFail:e=>{this.errorHandler(e)}})}}class ve extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppAddToFavorites",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_favorites"),text:getLang("apps_connect_modal_messages_request_add_to_favorites_text"),svgIcon:'<svg class="vk_app_modal_container__pic" width="56" height="56" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0H32V32H0z"/><path d="M15.487 22.565a.985.985 0 0 1 1.026 0l5.682 3.468c.004 0-.509-2.159-1.538-6.476a.983.983 0 0 1 .317-.975l5.056-4.328c.002-.004-2.211-.184-6.639-.54a.984.984 0 0 1-.83-.602L16.005 6.97c-.004-.003-.86 2.045-2.566 6.142a.984.984 0 0 1-.83.602l-6.637.532c-.003.002 1.681 1.448 5.054 4.336.28.24.402.616.317.975l-1.545 6.47c.001.005 1.898-1.15 5.69-3.462zm-4.656 5.146a1.974 1.974 0 0 1-2.947-2.14l1.405-5.886-4.6-3.937a1.97 1.97 0 0 1 1.126-3.462l6.038-.484 2.326-5.587a1.973 1.973 0 0 1 3.642 0l2.326 5.587 6.038.484a1.971 1.971 0 0 1 1.126 3.462l-4.6 3.937 1.405 5.886a1.97 1.97 0 0 1-2.947 2.14L16 24.556l-5.169 3.155z" fill="#528BCC" fill-rule="nonzero"/></g></svg>'},this.callApi=!0,this.useUI=!0}loadIntroData(e){this.request={...e},ajax.post("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${h.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:h.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{var s=JSON.parse(t);this.checkIntroData(s,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.added_to_favorites?this.successHandler({result:!0}):this.launchUI(t)}checkResponse(e){(0,n.isMvk)()?this.checkResponseMvk(e):this.checkResponseWeb(e)}checkResponseMvk(e){!0===e.result&&window.cur&&window.cur.VKApp&&(window.cur.VKApp.isFavorite=!window.cur.VKApp.isFavorite,window.DirectGames&&window.DirectGames.initMenu()),super.checkResponse(e)}checkResponseWeb(e){e.result&&e.result.left_nav&&(window.Apps.updateLeftNav(e.result.left_nav),window.Apps.updateAddToMenuAction(),e={result:e.result.success}),super.checkResponse(e)}handler(e,t,s){((0,U.partConfigEnabled)("mini_apps_web_add_to_favorites")||cur.app.isDirectGame)&&(this.setData(e,t),this.callback=s,this.loadIntroData())}}class be extends a.Handler{actionHandler(e){dr({handler:i.CONNECT_EVENTS.ADD_TO_FAVORITES,params:{...e,originalHandlerName:i.CONNECT_EVENTS.ADD_TO_MENU}},this.app)}}class ge extends a.Handler{constructor(e){super(e),this.onFlistHide=()=>{this.hasSuccess||this.errorHandler({code:h.ERROR_CODES.USER_DENIED})},this.params.handlerName="VKWebAppGetFriends",this.callApi=!0,this.isWebOnly=!0}loadIntroData(e){this.request={...e},cur.onFlistSave=(...e)=>this.onFlistSave(...e),cur.onFlistHide=this.onFlistHide,window.showTabbedBox("apps.php",{act:"handle_vk_connect_event",hash:cur.app.options[`${h.VK_CONNECT_EVENTS[`${this.params.handlerName}`]}_hash`],event:h.VK_CONNECT_EVENTS[`${this.params.handlerName}`],app_id:this.app.appId,...this.request},{stat:["ui_controls.js","ui_controls.css"]})}onFlistSave(e,t){this.hasSuccess=!0;var s={};s.users=t.friends.map((e=>{var t=e[1].split(" ");return{id:e[0],sex:parseInt(e[5],10),last_name:t[1]?t[1]:"",first_name:t[0],photo_200:e[2]}})),this.request.lists&&(s.lists=t.lists.map((e=>e[0])).sort()),this.successHandler(s)}handler(e,t,s){this.setData(e,t),this.callback=s,this.checkParams(e,[{param:"multi",type:"boolean"},{param:"lists",type:"boolean"}])&&(e.hasOwnProperty("lists")&&(e.lists=e.lists?1:0),e.hasOwnProperty("multi")&&(e.multi=e.multi?1:0),this.actionHandler(e))}actionHandler(e){this.loadIntroData(e)}}class Ne extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowCommunityWidgetPreviewBox",this.isWebOnly=!0}resetBox(){delete cur.onAppWidgetPreviewFail,delete cur.onAppWidgetPreviewCancel,delete cur.onAppWidgetPreviewSuccess,setTimeout((function(){delete cur.appWidgetPreviewBox}),3e3)}actionHandler(e){this.checkParams(e,[{param:"group_id",type:"number",isRequired:!0},{param:"type",type:"string",isRequired:!0}])&&this.showWidgetPreviewBox(e)}showWidgetPreviewBox(e){if(!cur.appWidgetPreviewBox){cur.appWidgetPreviewBox=!0,cur.onAppWidgetPreviewFail=e=>{this.resetBox(),this.errorHandler(e)},cur.onAppWidgetPreviewCancel=()=>{this.resetBox(),this.errorHandler({code:h.ERROR_CODES.USER_DENIED,reason:h.ERROR_REASONS.USER_DENIED})},cur.onAppWidgetPreviewSuccess=()=>{this.resetBox(),this.successHandler({result:!0})};var t=window.showBox("apps",{act:"app_widget_preview_box",aid:this.app.appId,hash:cur.app.options.hash,gid:e.group_id,type:e.type,code:e.code},{params:{width:600,containerClass:"apps_app_widget_preview_box"},onDone:()=>{t.setOptions({onHide:()=>{(0,o.isFunction)(cur.onAppWidgetPreviewCancel)&&cur.onAppWidgetPreviewCancel()}})},onFail:e=>(~e.indexOf("413 Request Entity Too Large")&&(e="413 Request Entity Too Large"),(0,o.isFunction)(cur.onAppWidgetPreviewFail)&&cur.onAppWidgetPreviewFail(e),!0)})}}}class Ie extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppOpenInNativeApp",this.useUI=!1,this.isMobileWebOnly=!0}actionHandler(e){var{ipad:t,iphone:s,android:r}=window.browser;if((0,n.isMvk)()&&(t||s||r)){if(!this.checkParams(e,[{param:"link",type:"string",isRequired:!0}]))return;this.openInNativeApp(e.link)}else this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM})}openInNativeApp(e){if(this._openAppInProgress)return!1;var t="vk://vk.com/"+e,s=browser.mi?1500:300;browser.safari&&(s=browser.ios>=12?2800:300);var r=Date.now(),a=setTimeout((()=>{this._openAppInProgress=!1,Date.now()-r>s+200||!document.hasFocus()?this.successHandler({result:!0}):(nav.hard_go("https://vk.cc/dl"),this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:h.ERROR_REASONS.NATIVE_APP_IS_NOT_INSTALLED}))}),s),i=()=>{clearTimeout(a),this._openAppInProgress=!1,window.removeEventListener("blur",i)};if(window.addEventListener("blur",i),browser.ios){var n=()=>{window.removeEventListener("focus",n)};window.addEventListener("focus",n)}return this._openAppInProgress=!0,nav.hard_go(t),!1}}class ke extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppLocationChanged"}get successDescriptor(){return`${this.params.handlerName}`}actionHandler(e){this.successHandler({location:e.location})}}class ye extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppClose"}closeMiniAppPage(e){if(cur.app.options.layer){var t=this.app.isVKPayApp&&cur.openerAppsQueue&&cur.openerAppsQueue.length>0;if(WkView.hide(t,!0),!t)return}var s,r=-1,a=window.history.length;if(s=(this.app.isTextliveApp||this.app.isVKPayApp)&&e.back_url?e.back_url:"/services",cur.VKApp){if(2===cur.VKApp.vkMiniAppsHistoryLength&&!document.referrer||1===cur.VKApp.vkMiniAppsHistoryLength)return void nav.go(s);cur.VKApp.vkMiniAppsHistoryLength!==a&&(r=cur.VKApp.vkMiniAppsHistoryLength-a-1)}!(r<=1)||this.app.isTextliveApp||this.app.isVKPayApp||cur.VKApp.vkMiniAppsHistoryLength>1?window.history.go(r):nav.go(s)}actionHandler(e){(0,n.isMvk)()?window.opener?(window.opener.postMessage({type:this.params.handlerName,name:this.successDescriptor,eventData:{status:e.status,payload:e.payload}},"*"),window.close()):this.closeMiniAppPage(e):cur.openerAppsQueue&&cur.openerAppsQueue.length>0&&Object.keys(cur.vkAppQueue).length>1?(cur.miniAppOpener&&cur.miniAppOpener.sendIframeMessage(this.successDescriptor,{status:e.status,payload:e.payload}),this.app.isVKPayApp?this.closeMiniAppPage(e):WkView.hide()):this.closeMiniAppPage(e)}handler(e,t,s){this.setData(e,t),this.callback=s;var r=[{param:"status",type:"string",extraChecks:[{check:e=>h.CLOSE_STATUS.includes(e),error:e=>`Param "${e}" should be "success" or "failed"`}]},{param:"payload",type:"object",isRequired:!1}];this.app.isTextliveApp&&r.push({param:"back_url",type:"string",isRequired:!1}),this.checkParams(e,r)&&this.actionHandler(e)}}var Ce=s(85701),we=s(41319);class fe extends a.Handler{constructor(...e){super(...e),this.params.handlerName="VKWebAppShowStoryBox",this.callApi=!1,this.useUI=!1}get loadFinishDescriptor(){return`${this.params.handlerName}LoadFinish`}loadFinishHandler(e){this.callback({type:this.loadFinishDescriptor,data:e},this.params.handlerName)}static isValidUrl(e){try{return!!new URL(e)}catch{return!1}}initStoryPublisher(e){window.StoryPublisher&&window.StoryPublisher.init(e,(()=>this.successHandler({result:!0})),((e,t)=>{if(!e){var s={code:h.ERROR_CODES.USER_DENIED};return t&&t.error&&t.error.message&&(s.reason=t.error.message),this.errorHandler(s)}if(t&&t.story){var{owner_id:r,id:a}=t.story;return this.loadFinishHandler({story_owner_id:r,story_id:a})}}))}validateParams(e){return!!this.checkFields(e)&&(!(e.attachment&&!this.checkAttachment(e.attachment))&&(!(e.stickers&&!this.checkStickers(e.stickers))&&!(e.service_info&&!this.checkServiceInfo(e.service_info))))}checkFields(e){var t={check:e=>fe.isValidUrl(e),error:e=>`Param "${e}" incorrect`};return this.checkParams(e,[{param:"background_type",type:"string",isRequired:!0,extraChecks:[{check:e=>(0,n.isMvk)()?"image"===e||"video"===e:"image"===e,error:e=>(0,n.isMvk)()?`Param "${e}" should be a image or video`:`Param "${e}" should be a image`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[t]},{param:"blob",type:"string",isRequired:!e.url,extraChecks:[{check:()=>"image"===e.background_type,error:e=>`Param "${e}" available only for image background_type`},t]},{param:"attachment",type:"object"},{param:"stickers",type:"object",extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]},{param:"service_info",type:"object"}])}checkAttachment(e){var t=["url","photo","video","audio"],s=["to_store","vote","more","book","order","enroll","fill","signup","buy","ticket","game","write","open","learn_more","view","go_to","contact","watch","play","install","read","to_memories_app","nft_avatar"];return!!this.checkParams(e,[{param:"text",type:"string",isRequired:!0,extraChecks:[{check:e=>s.includes(e),error:e=>`Param "${e}" should be a ${s.join(", ")}`}]},{param:"type",type:"string",isRequired:!0,extraChecks:[{check:e=>t.includes(e),error:e=>`Param "${e}" should be a ${t.join(", ")}`}]}])&&("url"===e.type?this.checkParams(e,[{param:"url",type:"string",isRequired:!0,extraChecks:[{check:e=>fe.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]}]):this.checkParams(e,[{param:"owner_id",type:"number",isRequired:!0},{param:"id",type:"number",isRequired:!0},{param:"access_key",type:"string"}]))}checkStickers(e){return!e.length||e.every((e=>!!this.checkStickerContainer(e)&&!!this.checkSticker(e.sticker_type,e.sticker)))}checkServiceInfo(e){return this.checkParams(e,[{param:"open_text_editor",type:"boolean"}])}checkStickerContainer(e){return this.checkParams(e,[{param:"sticker_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["native","renderable"].includes(e),error:e=>`Param "${e}" should be a native or renderable`}]},{param:"sticker",type:"object",isRequired:!0}])}checkSticker(e,t){return"renderable"===e?this.checkRenderableSticker(t):"native"===e?this.checkNativeSticker(t):(this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "sticker_type" should be a native or renderable'}),!1)}checkNativeSticker(e){return!!this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["text","sticker"].includes(e),error:e=>`Param "${e}" should be a text or sticker`}]},{param:"action",type:"object",isRequired:!0},{param:"transform",type:"object",isRequired:!1}])&&(!!this.checkAction(e.action_type,e.action)&&!(e.transform&&!this.checkTransform(e.transform)))}checkAction(e,t){return"text"===e?this.checkParams(t,[{param:"text",type:"string",isRequired:!0},{param:"style",type:"string"},{param:"background_style",type:"string"},{param:"alignment",type:"string"},{param:"selection_color",type:"string"}]):"sticker"===e?this.checkParams(t,[{param:"sticker_id",type:"number",isRequired:!0},{param:"pack_id",type:"number"}]):"link"===e?this.checkParams(t,[{param:"link",type:"string",isRequired:!0},{param:"tooltip_text_key",type:"string"}]):"app"===e?this.checkParams(t,[{param:"app_id",type:"number",isRequired:!0},{param:"app_context",type:"string"}]):"situational_theme"===e?0===Object.keys(t).length||(this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param situational_theme "action" should be empty'}),!1):"mention"===e?this.checkParams(t,[{param:"mention",type:"string",isRequired:!0}]):(this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Param "action_type" should be a sticker or text'}),!1)}checkTransform(e){var t=["left_top","left_center","left_bottom","center_top","center","center_bottom","right_top","right_center","right_bottom"];return this.checkParams(e,[{param:"rotation",type:"number",isRequired:!1},{param:"relation_width",type:"number",isRequired:!1},{param:"translation_x",type:"number",isRequired:!1},{param:"translation_y",type:"number",isRequired:!1},{param:"gravity",type:"string",isRequired:!1,extraChecks:[{check:e=>t.includes(e),error:e=>`Param "${e}" should be ${t.join(", ")}`}]}])}checkRenderableSticker(e){return!!this.checkParams(e,[{param:"content_type",type:"string",isRequired:!0,extraChecks:[{check:e=>"image"===e,error:e=>`Param "${e}" should be a image`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[{check:e=>fe.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]},{param:"blob",type:"string",isRequired:!e.url},{param:"transform",type:"object",isRequired:!1},{param:"clickable_zones",type:"object",isRequired:!1,extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])&&(!(e.transform&&!this.checkTransform(e.transform))&&!(e.clickable_zones&&!this.checkClickableZones(e.clickable_zones)))}checkClickableZones(e){return e.every((t=>!!this.checkClickableZone(t)&&(!!this.checkAction(t.action_type,t.action)&&(!e.clickable_area||(4!==e.clickable_area.length?(this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:'Sticker "clickable_area" should include 4 points'}),!1):e.clickable_area.every((e=>this.checkParams(e,[{param:"x",type:"number",isRequired:!0},{param:"y",type:"number",isRequired:!0}]))))))))}checkClickableZone(e){return this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["link","app","situational_theme","mention"].includes(e),error:e=>`Param "${e}" should be a link, app, situational_theme or mention`}]},{param:"action",type:"object",isRequired:!0},{param:"clickable_area",type:"object",extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])}}class Pe extends fe{actionHandler(e){if(this.validateParams(e)){var{storyUploadUrlHash:t,storySaveHash:s}=this.getEventHashes();this.initStoryPublisher({entrypoint:we.StoryEntryPoint.MINI_APP,miniAppId:Number(this.app.appId),miniAppName:this.app.vkApp.options.app_name,storyUploadUrlHash:t,storySaveHash:s,maxVideoDuration:Ce.MAX_STORY_VIDEO_DURATION,closeAfterError:!0,...e})}}}class Te extends fe{actionHandler(e){if(!(0,U.partConfigEnabled)("web2_story_box_enabled"))return this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.validateParams(e)&&window.stManager.add([window.jsc("web/story_publisher.js")]).then((()=>{this.initStoryPublisher({entrypoint:we.StoryEntryPoint.MINI_APP,miniAppId:Number(this.app.appId),photoUrl:e.url?e.url:e.blob,stickers:e.stickers,attachment:e.attachment,serviceInfo:e.service_info,...e})})).catch((()=>{this.errorHandler({code:h.ERROR_CODES.UNKNOWN})}))}}class He{constructor(...e){return(0,n.isMvk)()?new Pe(...e):new Te(...e)}}class De extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppSubscribeStoryApp",this.callApi=!1,this.useUI=!1}actionHandler(e){if(this.validateParams(e)){var t={act:"subscribe_user_to_app",story_owner_id:e.story_owner_id,story_id:e.story_id,access_key:e.access_key,sticker_id:e.sticker_id,hash:this.getEventHash(),app_id:this.app.appId},s=t=>{this.handleResponse(t,e,(e=>this.successHandler(e)))},r=e=>{this.errorHandler(e)};(0,n.isMvk)()?window.ajax.post("stories.php",t,{onDone:(e,t)=>t?r(t):s(e)}):window.ajax.post("al_stories.php",t,{onDone:s,onFail:r})}}validateParams(e){return this.checkParams(e,[{param:"story_owner_id",type:"number",isRequired:!0},{param:"story_id",type:"number",isRequired:!0},{param:"sticker_id",type:"number",isRequired:!0},{access_key:"string",type:"string",isRequired:!1}])}}class Le extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetPersonalCard"}actionHandler(){this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class Me extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppOpenContacts"}actionHandler(){this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}class Ve extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppOpenCodeReader"}actionHandler(){this.errorHandler({code:h.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:h.ERROR_REASONS.UNSUPPORTED_PLATFORM},this.callback)}}var We,xe,Ke,Ue,Fe,Be=s(72946),Ge=s(70313);!function(e){e.PRELOADER="preloader",e.REWARD="reward",e.INTERSTITIAL="interstitial"}(We||(We={})),function(e){e[e.PRELOADER=1]="PRELOADER",e[e.REWARDED=2]="REWARDED"}(xe||(xe={})),function(e){e.STATISTICS="statistics"}(Ke||(Ke={})),function(e){e.PREROLL="preroll"}(Ue||(Ue={})),function(e){e.NETWORK_NO_AD="network_no_ad",e.NETWORK_ERROR="network_error",e.INTERNAL_TIMEOUT="timeout"}(Fe||(Fe={}));const qe={mobile:/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),FLASH_BLOCKED:0,FLASH_READY:1,FLASH_UNKNOWN:2,checkFlashStatus:e=>e(qe.FLASH_UNKNOWN)},$e={vpaidJsInterface:"https://ad.mail.ru/static/vpaid-js-interface.swf"};let je;const Ye=()=>je||(je=document.querySelector(".app_container"),je);var Je=s(99536),ze=s(16022);class Qe{constructor(){this.player=document.createElement("div"),this.player.classList.add("AdmanPlayerLayer"),this.content=document.createElement("div"),this.content.classList.add("AdmanContent"),(0,n.isMvk)()&&this.content.classList.add("AdmanContent--fluid"),this.player.appendChild(this.content),this.videoContainer=document.createElement("video"),this.videoContainer.classList.add("AdmanVideoContainer"),this.videoContainer.playsInline=!0,this.content.appendChild(this.videoContainer),this.controls=document.createElement("div"),this.buttonMute=document.createElement("button"),this.buttonMute.classList.add("AdmanControlsMute"),this.controls.appendChild(this.buttonMute),this.content.appendChild(this.controls)}get getPlayer(){return this.player}get getContent(){return this.content}get getVideoContainer(){return this.videoContainer}changeMuteState(e){e?(this.setMuteIcon(),this.buttonMute.dataset.muted="muted"):(this.setVolumeIcon(),delete this.buttonMute.dataset.muted)}setVolumeIcon(){this.buttonMute.innerHTML=(0,Je.getIcon24VolumeOutline)().icon}setMuteIcon(){this.buttonMute.innerHTML=(0,ze.getIcon24MuteOutline)().icon}onClickMute(e){const t=this.buttonMute.dataset.muted;e.setVolume(t?1:0),this.videoContainer.muted=!t,this.changeMuteState(!t)}onVolumeChange(){let e=this.videoContainer.muted||!this.videoContainer.volume;this.changeMuteState(e)}hideControls(){this.videoContainer.controls=!1}admanStart(e){this.hideControls(),this.videoContainer.onvolumechange=()=>this.onVolumeChange(),this.buttonMute.onclick=()=>this.onClickMute(e),this.onVolumeChange()}hideMutedButton(){this.buttonMute.classList.add("hidden")}}const Xe=[],Ze=()=>Xe.length>0,et=(e,t)=>{Xe.push([e,t,Date.now()])},tt=()=>Xe.shift(),st=()=>window.cur.app.options.ads_options,rt=()=>st().rewarded_slots,at=()=>st()?.sign,it=()=>st().sign_timestamp;let nt=[],ot=[];const pt=e=>!(!e||!e.ad_format)&&Object.values(We).includes(e.ad_format),ct=(e,t)=>{if(Ze())return void e();if(window.AdmanHTML)return void e();let s;const r=()=>{clearTimeout(s),delete window.admanAsyncInit,window.AdmanHTML?e():t()};(0,Ge.loadScript)("//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",{timeout:2e3,onLoad:()=>{window.AdmanHTML?e():(window.admanAsyncInit=r,s=window.setTimeout(r,2e3))},onError:t})},dt=(e,t,s)=>{const r=new Qe,a=Ye(),i=rt().filter((e=>!nt.includes(e))),n={type:e,selectedSlot:0,alreadyUsedSlots:nt,skippedReasons:ot},o={vk_id:window.vk.id,content_id:window.cur.aid,type_load:e===We.REWARD?xe.REWARDED:xe.PRELOADER,rewarded:Number(e===We.REWARD),sign:at(),ts:it()},p=new window.AdmanHTML;p.setDebug(window.__debugMode);const[c]=i;n.selectedSlot=c,p.init({slot:c,wrapper:r.getContent,videoEl:r.getVideoContainer,videoQuality:360,params:o,browser:qe,config:$e});const d={},l=(e,t)=>{p[e](((...s)=>{t(...s),d[e]&&d[e](...s)})),p[e]=t=>{d[e]=t}},h=p.start;p.start=()=>{a?.appendChild(r.getPlayer),r.admanStart(p),h.apply(p,[])};const _=r=>{if(p.destroy(),nt.push(c),ot.push(r),rt().length===nt.length)return s(n),nt=[],void(ot=[]);dt(e,t,s)};l("onError",(()=>{_(Fe.NETWORK_ERROR)})),l("onReady",(()=>{p.getBannersForSection(Ue.PREROLL).some((e=>e.type&&e.type!==Ke.STATISTICS))?t(p,n):_(Fe.NETWORK_NO_AD)})),l("onStarted",((e,t)=>{t?.hasVolume||r.hideMutedButton()})),l("onCompleted",(()=>{a?.removeChild(r.getPlayer),p.destroy()})),l("onPlayed",(()=>r.hideControls()))},lt=(e,t,s)=>{if(Ze())return void t();dt(e,((e,s)=>{et(e,s),t()}),s)},ht=[];let _t,ut,mt=!1;const Rt=()=>ht.length>0,Et=e=>{ht.push(e)},At=()=>ht.shift(),St=()=>_t||(_t=document.createElement("div"),_t.classList.add("InterstitialAdContainerRoot"),document.querySelector(".app_container")?.appendChild(_t),_t),Ot=()=>{_t?.remove(),_t=void 0},vt=e=>{ut=e},bt=()=>ut,gt=e=>{mt=e},Nt=()=>mt;var It,kt,yt;!function(e){e.SlotID="q",e.SiteId="_SITEID",e.VKUserId="vk_id",e.AppId="content_id",e.Lang="lang",e.Sign="sign",e.Timestamp="ts"}(It||(It={})),function(e){e.TEASER="teaser"}(kt||(kt={})),function(e){e.IMPRESSION="impression"}(yt||(yt={}));const Ct=(e,t)=>{if(Rt())return void e();const s=window.cur?.aid||0,r=new URLSearchParams,[a]=st().interstitial_slots;if(!a)return void t();r.set(It.SlotID,a.toString()),r.set(It.SiteId,st().site_id.toString()),r.set(It.Lang,window.langConfig.locale.toLowerCase()),r.set(It.VKUserId,window.vk.id.toString()),r.set(It.AppId,s.toString()),r.set(It.Sign,at()),r.set(It.Timestamp,it().toString());const i={type:We.INTERSTITIAL,selectedSlot:a,skipped_slots:[]},n=`https://ad.mail.ru/adp/?${r.toString()}`;fetch(n).then((e=>e.json())).then((s=>{s&&s[0]&&Object.values(s[0].json).length>0?(Et(s[0]),e()):t(i)})).catch((()=>t(i)))};var wt=s(91896),ft=s(56769),Pt=s(93176),Tt=s(78225);const Ht=()=>{const e=(0,Tt.useClassNamesByPlatform)("InterstitialAdImage"),t=(0,ft.useContext)(bt()),s=t.statistics.filter((({type:e})=>e===yt.IMPRESSION));return(0,wt.jsxs)("div",Object.assign({className:e},{children:[(0,wt.jsx)("img",{className:"InterstitialAdImage__cover",alt:"Ads cover",src:t.image_600x600||t.image},void 0),s.map((({url:e},t)=>(0,wt.jsx)("img",{alt:"Ads pixel",className:"InterstitialAdImage__pixel",src:e},t))),t.age_restrictions&&(0,wt.jsx)("div",Object.assign({className:"InterstitialAdImage__ageLimit"},{children:t.age_restrictions}),void 0)]}),void 0)};var Dt=s(93617);const Lt=()=>{let e="",t="";return void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),{hidden:e,visibilityEvent:t}},Mt=()=>{const e=(0,Tt.useClassNamesByPlatform)("InterstitialAdFieldsHeader"),t=(0,ft.useContext)(bt()),[s,r]=(0,ft.useState)(0),[a,i]=(0,ft.useState)(5),[n,o]=(0,ft.useState)(!1),p=()=>{n||(a>0?r(window.setTimeout((()=>i((e=>e-1))),1e3)):t.onDestroy())};(0,ft.useEffect)((()=>(p(),()=>clearTimeout(s))),[a]);const c=()=>{const{hidden:e}=Lt(),t=document[e];o(t),t?window.clearTimeout(s):p()};return(0,ft.useEffect)((()=>{const{visibilityEvent:e}=Lt();if(e)return document.addEventListener(e,c,!1),()=>document.removeEventListener(e,c,!1)}),[]),(0,wt.jsx)("header",Object.assign({className:e},{children:(0,wt.jsx)(Dt.Caption,Object.assign({weight:"regular",level:"1"},{children:(0,wt.jsxs)("span",{children:["Реклама закроется через ",a," секунд"]},void 0)}),void 0)}),void 0)},Vt=()=>{const e=(0,Tt.useClassNamesByPlatform)("InterstitialAdFieldsFooter"),t=(0,ft.useContext)(bt());return(0,wt.jsxs)("footer",Object.assign({className:e},{children:[(0,wt.jsx)(Dt.Title,Object.assign({className:"InterstitialAdFieldsFooter__title",weight:"medium",level:"2"},{children:t.title}),void 0),(0,wt.jsx)(Dt.Subhead,Object.assign({className:"InterstitialAdFieldsFooter__description",weight:"regular"},{children:t.description}),void 0),t.disclaimer&&(0,wt.jsx)(Dt.Caption,Object.assign({className:"InterstitialAdFieldsFooter__offer",weight:"regular",level:"3"},{children:t.disclaimer}),void 0),(0,wt.jsx)(Dt.Button,Object.assign({className:"InterstitialAdFieldsFooter__button",size:(0,n.isMvk)()?"m":"s",mode:(0,n.isMvk)()?"overlay_primary":"primary",stretched:!0},{children:window.getLang("apps_ad_go_to_site")}),void 0)]}),void 0)},Wt=()=>{const e=(0,Tt.useClassNamesByPlatform)("InterstitialAdFields");return(0,wt.jsxs)("div",Object.assign({className:e},{children:[(0,wt.jsx)(Mt,{},void 0),(0,wt.jsx)(Vt,{},void 0)]}),void 0)},xt=()=>{const e=(0,ft.useContext)(bt()),t=(0,Tt.useClassNamesByPlatform)("InterstitialAdContainer"),s=(0,Tt.useClassNamesByPlatform)("InterstitialAd");return(0,wt.jsx)("a",Object.assign({target:"_blank",href:e.url,className:t},{children:(0,wt.jsxs)("div",Object.assign({className:s},{children:[(0,wt.jsx)(Ht,{},void 0),(0,wt.jsx)(Wt,{},void 0)]}),void 0)}),void 0)},Kt=()=>{Pt.render((0,wt.jsx)(ft.StrictMode,{children:(0,wt.jsx)(Dt.ConfigProvider,Object.assign({scheme:"inherit",platform:(0,n.isMvk)()?void 0:Dt.Platform.VKCOM},{children:(0,wt.jsx)(Dt.AppRoot,Object.assign({mode:"partial",noLegacyClasses:!0},{children:(0,wt.jsx)(xt,{},void 0)}),void 0)}),void 0)},void 0),St())},Ut=(e,t)=>{const s=At();s&&(s.json.onDestroy=()=>{Pt.unmountComponentAtNode(St()),Ot(),t()},vt((0,ft.createContext)(s.json)),e(s),Nt()?Kt():window.ajax.post("/apps",{act:"load_vkui_styles"},{onDone:()=>{Kt(),gt(!0)}}))};class Ft extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowNativeAds",this.appId=cur.app.params.api_id,this.userId=cur.app.params.viewer_id,this.isTimeRemained=!1,this.actionHandler=this.actionHandler.bind(this),this.sendNoAds=this.sendNoAds.bind(this),this.onAdmanAdsReady=this.onAdmanAdsReady.bind(this),this.sendCompletedStats=this.sendCompletedStats.bind(this),this.admanOnTimeRemained=this.admanOnTimeRemained.bind(this),this.sendWatchAdsCompleted=this.sendWatchAdsCompleted.bind(this),this.sendInterstitialAdsCompleted=this.sendInterstitialAdsCompleted.bind(this),this.onFallbackInterstitialStart=this.onFallbackInterstitialStart.bind(this),this.onInterstitialStart=this.onInterstitialStart.bind(this)}actionHandler(e){if(pt(e)){var t=e.ad_format;if(t!==We.INTERSTITIAL){var s={type:t,selectedSlot:0,skipped_slots:[],skipped_reasons:[]};ct((()=>{lt(t,this.onAdmanAdsReady,(t=>this.sendNoAdsOrShowFallback(t,e.use_waterfall)))}),(()=>this.sendNoAdsOrShowFallback(s,e.use_waterfall)))}else Ct((()=>Ut(this.onInterstitialStart,this.sendInterstitialAdsCompleted)),this.sendNoAds)}else this.sendInvalidParamsError()}sendNoAdsOrShowFallback(e,t){if(void 0!==t&&!0!==t)this.sendNoAds(e);else{var s=t=>this.onFallbackInterstitialStart(e,t);Ct((()=>{Ut(s,this.sendInterstitialAdsCompleted)}),(t=>this.onFallbackInterstitialNoAds(e,t)))}}getActualParamsFromFallback(e,t){var s=e;return s.actualAdFormat=We.INTERSTITIAL,s.selectedSlot=t.slot||t.selectedSlot,s}onFallbackInterstitialStart(e,t){this.sendCompletedStats(this.getActualParamsFromFallback(e,t),!0)}onFallbackInterstitialNoAds(e,t){this.sendNoAds(this.getActualParamsFromFallback(e,t))}onAdmanAdsReady(){var[e,t]=tt();e.start(Ue.PREROLL),e.onTimeRemained(this.admanOnTimeRemained),e.onCompleted((()=>this.completedWatchAds(t)))}admanOnTimeRemained(){this.isTimeRemained=!0}completedWatchAds(e){this.isTimeRemained?this.sendWatchAdsCompleted(e):this.sendNoAds(e)}onInterstitialStart(e){this.sendCompletedStats({type:We.INTERSTITIAL,selectedSlot:e.slot,skipped_slots:[],skipped_reasons:[]},!0)}sendInterstitialAdsCompleted(){this.successHandler({result:!0})}sendWatchAdsCompleted(e){this.successHandler({result:!0}),this.sendCompletedStats(e,!0)}sendCompletedStats(e,t){Be.adMiniAppsEventItemStat.logEvent(this.appId,{event_type:"show_ad",ad_format:e.type,ad_available:t,actual_slot_id:Number(e.selectedSlot),skipped_slots:e.alreadyUsedSlots||[],actual_ad_format:e.actualAdFormat||e.type,skipped_reasons:e.skippedReasons||[]})}sendNoAds(e){this.sendCompletedStats(e,!1),this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:h.ERROR_REASONS.NO_ADS})}sendErrorAdsAlreadyPlayed(){this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:h.ERROR_REASONS.ADS_ALREADY_PLAYED})}sendInvalidParamsError(){this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:h.ERROR_REASONS.INVALID_PARAMS})}}var Bt=s(30038),Gt=s(20598),qt=s(70162),$t={CREATE:"create",RESUME:"resume",CANCEL:"cancel"},jt="waiting",Yt="loaded",Jt="active",zt="cancelled",Qt="charged",Xt=1,Zt={CANNOT_BE_RESUMED:7,NOT_ENOUGH_VOTES:8,ALREADY_EXISTS:9,NOT_FOUND:10},es=1,ts=0,ss=1,rs={error_type:h.ERROR_TYPES.CLIENT,code:h.ERROR_CODES.CONNECTION_LOST},as={DATE:"{date}",LINK_OPEN_TAG:"{link}",LINK_CLOSE_TAG:"{/link}"};class is extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowSubscriptionBox",this.useUI=!1,this.callApi=!1,this.controller="/apps",this.itemId="",this.orderId=0,this.isResume=!1,this.votesRefillOptions=null}actionHandler(e){e.hasOwnProperty("action")?~Object.values($t).indexOf(e.action)?e.action!==$t.CREATE||e.hasOwnProperty("item")?e.action!==$t.RESUME&&e.action!==$t.CANCEL||e.hasOwnProperty("subscription_id")?this.handleSubscriptionFlow(e):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:h.ERROR_REASONS.INVALID_PARAMS,description:'Missing required param "subscription_id"'}):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:h.ERROR_REASONS.INVALID_PARAMS,description:'Missing required param "item"'}):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:h.ERROR_REASONS.INVALID_PARAMS,description:'Param "action" must be one of: create, resume or cancel'}):this.errorHandler({code:h.ERROR_CODES.MISSING_PARAM,reason:h.ERROR_REASONS.INVALID_PARAMS,description:'Missing required param "action"'})}handleSubscriptionFlow(e){e.action===$t.CANCEL?this.initiateSubscriptionCancel(e.subscription_id):(this.isResume=e.action===$t.RESUME,this.itemId=this.isResume?e.subscription_id:e.item,this.initiateSubscription())}initiateSubscriptionCancel(e){this.showSubscriptionCancelLoader(),(0,l.api)("orders.getUserSubscription",{app_id:this.app.appId,subscription_id:e}).then((e=>{if(this.loader){this.hideLoader();var t=e.status===zt,s=e.status===Jt&&e.pending_cancel;t||s?this.showErrorModal(getLang("vkapps_connect_modal_subscription_already_cancelled"),void 0,(()=>{this.errorHandler({code:h.ERROR_CODES.CUSTOM,error_msg:h.ERROR_REASONS.SUBSCRIPTION_IS_ALREADY_CANCELLED},void 0,h.ERROR_TYPES.API)})):this.showSubscriptionCancelModal(e)}})).catch((e=>{if(this.loader){this.hideLoader();var{error:t,type:s}=e;this.showErrorModal(getLang("vkapps_connect_modal_subscription_unknown_error_title"),getLang("vkapps_connect_modal_subscription_unknown_error_desc"),(()=>{this.errorHandler({code:t.error_code,error_msg:t.error_msg},void 0,s)}))}}))}showSubscriptionCancelModal(e){var t=cur.app.options.vkApp?getLang("vkapps_connect_modal_cancel_subscription_in_service"):getLang("vkapps_connect_modal_cancel_subscription_in_game");t=t.replace("{subscription_name}",e.title).replace("{app_name}",e.application_name);var s=(0,qt.langNumeric)(e.price,getLang("apps_connect_n_votes","raw")).replace("{count}",e.price),r=(0,qt.langNumeric)(e.period,getLang("apps_connect_days","raw")).replace("{count}",e.period),a=getLang("vkapps_connect_modal_subscription_charges_info").replace("{votes}",s).replace("{period}",r),i=this.getNextBillTimeText(e.expire_time),o=getLang("vkapps_connect_subscription_next_bill_time").replace("{date}",i),[p,c]=this.getCancelSubscriptionModalButtons();this.modal=new R.UIAction({pic:e.photo_url,title:t,text:[`<span class="vk_app_modal_container__accent_text_row">${a}</span>`,o],isTextSeparated:!0,buttons:p,buttonsClass:"MiniAppsNoWrapButtons",containerClass:"vk_app_modal_container--subscription",showCloseBtn:!(0,n.isMvk)(),closeButtonMode:R.CLOSE_BUTTON_MODES.OUTER,allowAction:this.cancel.bind(this),cancelAction:()=>this.cancelSubscription(e.id,c),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0,containerId:this.params.modal.containerId}),m.default.push(this.modal),this.markItemPictureAsLoaded()}showErrorModal(e,t,s){var r=new R.UIAction({title:e,text:t,buttons:[{title:cur.app.options.vkApp?getLang("vkapps_connect_modal_back_to_service"):getLang("vkapps_connect_modal_back_to_game"),type:"deny"}],buttonsClass:"MiniAppsNoWrapButtons",showCloseBtn:!(0,n.isMvk)(),closeButtonMode:R.CLOSE_BUTTON_MODES.OUTER,withoutAnimation:!0,containerId:this.params.modal.containerId,containerClass:"vk_app_modal_container--subscription",svgIcon:this.getWarningIcon(),cancelAction:()=>{s(),m.default.pop(r)}});m.default.push(r)}cancelSubscription(e,t){this.setModalInProgress(t),(0,l.api)("orders.cancelUserSubscription",{app_id:this.app.appId,subscription_id:e}).then((()=>{this.hideModal(),this.successHandler({success:!0,subscriptionId:e})})).catch((e=>{var{error:t,type:s}=e;this.hideModal(),this.showErrorModal(getLang("vkapps_connect_modal_subscription_cancel_error_title"),getLang("vkapps_connect_modal_subscription_unknown_error_desc"),(()=>{this.errorHandler({code:t.error_code,error_msg:t.error_msg},void 0,s)}))}))}initiateSubscription(){this.showSubscriptionRetrievalLoader(),this.loadSubscriptionData().then((e=>{this.hideLoader(),this.showSubscriptionConfirm(e)})).catch((e=>{this.hideLoader(),this.handleSubscriptionInitiationError(e)}))}handleSubscriptionInitiationError(e){var t=void 0,s=void 0;switch(e.code){case Zt.CANNOT_BE_RESUMED:t=getLang("global_error_occured"),s=getLang("vkapps_connect_modal_subscription_cannot_be_resumed_error");break;case Zt.NOT_FOUND:t=getLang("vkapps_connect_modal_subscription_not_found_error");break;case Zt.ALREADY_EXISTS:t=getLang("vkapps_connect_modal_subscription_already_exists_error");break;default:t=getLang("vkapps_connect_modal_subscription_unknown_error_title"),s=getLang("vkapps_connect_modal_subscription_unknown_error_desc")}var r={code:h.ERROR_CODES.UNKNOWN};Object.values(Zt).includes(e.code)&&(r={code:h.ERROR_CODES.CUSTOM,error_msg:e.reason}),this.showErrorModal(t||void 0,s||void 0,(()=>{this.errorHandler(r)}))}loadSubscriptionData(){return new Promise(((e,t)=>{var s=0;this.interval=setInterval((()=>{ajax.post(this.controller,{act:"handle_vk_connect_event",event:this.getEventName(),hash:this.getEventHash(),item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,resume:Number(this.isResume)},{onDone:r=>{if((r=JSON.parse(r)).hasOwnProperty("error"))t(r.error);else switch(r.status){case jt:this.orderId=r.order_id,(s+=1)>=30&&t({code:h.ERROR_CODES.CUSTOM,reason:"Can't load subscription"});break;case Yt:this.orderId=r.order_id,this.confirmHash=r.confirm_hash,this.orderHash=r.order_hash,r.votes_refill_options&&(this.votesRefillOptions=r.votes_refill_options),e(r.item_data)}},onFail:()=>{t(rs)}})}),3e3)})).finally((()=>{clearInterval(this.interval)}))}showSubscriptionConfirm(e){var t=this.isResume?getLang("vkapps_connect_modal_subscription_resume_title").replace("{subscription_name}",e.title):e.title,s=this.getSubscriptionDurationInfo(e),r=this.getSubscriptionNextBillTimeInfo(e),[a,i]=this.getSubscriptionModalButtons(e),o=Boolean(e.trial_duration),p=()=>this.confirmSubscription(i);(0,n.isMvk)()||null===this.votesRefillOptions||(p=()=>this.refillVotesBalance(i)),this.modal=new R.UIAction({pic:e.photo_url,title:t,subheading:e.description,isTextSeparated:!0,text:[s,r],buttons:a,buttonsClass:o?"MiniAppsNoWrapButtons":void 0,containerClass:"vk_app_modal_container--subscription",showCloseBtn:!(0,n.isMvk)(),closeButtonMode:R.CLOSE_BUTTON_MODES.OUTER,allowAction:p,cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0,containerId:this.params.modal.containerId}),m.default.push(this.modal),this.markItemPictureAsLoaded()}confirmSubscription(e){this.setModalInProgress(e),ajax.post(this.controller,{act:"handle_vk_connect_event",event:"confirm_subscription",item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,hash:this.confirmHash,order_hash:this.orderHash},{onDone:e=>{if(this.hideModal(),(e=JSON.parse(e)).status!==Qt)if(e.hasOwnProperty("error")&&e.error.code===Zt.NOT_ENOUGH_VOTES)this.showErrorModal(getLang("vkapps_connect_modal_subscription_error_title_not_enough_votes"),getLang("vkapps_connect_modal_subscription_error_desc_not_enough_votes"),(()=>{this.errorHandler({code:h.ERROR_CODES.CUSTOM,error_msg:e.error.reason})}));else{var t=this.isResume?getLang("vkapps_connect_modal_subscription_resuming_error_title"):getLang("vkapps_connect_modal_subscription_payment_error_title");this.showErrorModal(t,getLang("vkapps_connect_modal_subscription_unknown_error_desc"),(()=>{this.errorHandler(e.error)}))}else this.successHandler({success:!0,subscriptionId:e.subscription_id})},onFail:()=>{this.hideModal();var e=this.isResume?getLang("vkapps_connect_modal_subscription_resuming_error_title"):getLang("vkapps_connect_modal_subscription_payment_error_title");this.showErrorModal(e,getLang("vkapps_connect_modal_subscription_unknown_error_desc"),(()=>{this.errorHandler(rs)}))}})}cancel(){clearInterval(this.interval),this.denyUIAction(),this.hideLoader()}refillVotesBalance(e){this.setModalInProgress(e),cur.onSubscriptionCancel=()=>{this.hideModal(),this.errorHandler({reason:h.ERROR_REASONS.USER_DENIED,code:h.ERROR_CODES.USER_DENIED})};var t={act:"a_order",aid:this.app.appId,order_id:this.orderId,votes:0,test_mode:this.votesRefillOptions.test_mode,hash:this.votesRefillOptions.hash,from:nav.objLoc[0],_votes_ok:0};ajax.post("al_apps.php",t,{forceDone:0,onDone:(e,t,s)=>{if(0===s||s>0)return this.hideModal(),void this.showErrorModal(getLang("global_error_occured"),void 0,(()=>{this.errorHandler({reason:h.ERROR_REASONS.UNKNOWN_ERROR,code:h.ERROR_CODES.UNKNOWN})}));this.checkOrderStatus(e)},onFail:e=>!e||(this.hideModal(),this.showErrorModal(getLang("global_error_occured"),e,(()=>{this.errorHandler({reason:h.ERROR_REASONS.UNKNOWN_ERROR,code:h.ERROR_CODES.UNKNOWN})})),!0)})}checkOrderStatus(e,t=0){if(t>=10)return this.hideModal(),void this.showErrorModal(getLang("global_error_occured"),getLang("vkapps_connect_modal_subscription_purchase_error_title"),(()=>{this.errorHandler({reason:"Cannot perform subscription",code:h.ERROR_CODES.UNKNOWN},null,h.ERROR_TYPES.API)}));var{orderId:s,checkHash:r,subscriptionId:a}=e;ajax.post("al_apps.php",{act:"a_check_order",aid:this.app.appId,order_id:s,test_mode:this.votesRefillOptions.test_mode,from:nav.objLoc[0],hash:r},{onDone:s=>{s?(this.hideModal(),s===Xt?this.successHandler({success:!0,subscriptionId:a}):this.showErrorModal(getLang("global_error_occured"),void 0,(()=>{this.errorHandler({reason:h.ERROR_REASONS.UNKNOWN_ERROR,code:h.ERROR_CODES.UNKNOWN})}))):setTimeout((()=>this.checkOrderStatus(e,t+1)),2e3)},onFail:e=>(this.hideModal(),this.showErrorModal(getLang("global_error_occured"),e,(()=>{this.errorHandler({reason:h.ERROR_REASONS.UNKNOWN_ERROR,code:h.ERROR_CODES.UNKNOWN})})),!0)})}hideModal(){this.modal&&(m.default.pop(this.modal),this.modal.destroy()),this.modal=null}showSubscriptionCancelLoader(){this.showLoader({buttons:[{title:getLang("vkapps_connect_modal_keep_subscription"),type:"success"},{title:getLang("vkapps_connect_modal_cancel_subscription"),type:"deny",disabled:!0}],buttonsClass:"MiniAppsNoWrapButtons",title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_subscription_waiting_item_desc"),allowAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--loader",svgIcon:this.getLoaderIcon(),containerId:this.params.modal.containerId,onlyButtonHide:!0})}showSubscriptionRetrievalLoader(){this.showLoader({buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny"},{title:getLang("vkapps_connect_modal_confirm"),type:"success",disabled:!0}],title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_subscription_waiting_item_desc"),cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--loader",svgIcon:this.getLoaderIcon(),containerId:this.params.modal.containerId,onlyButtonHide:!0})}showLoader(e){this.loader=new R.UIAction({...e}),m.default.push(this.loader)}hideLoader(){this.loader&&(m.default.pop(this.loader),this.loader.destroy()),this.loader=null}setModalInProgress(e){var t=this.modal.props;this.hideModal(),t.buttons.forEach(((t,s)=>{s===e?t.loading=!0:t.disabled=!0})),t.showCloseBtn=!1,this.modal=new R.UIAction(t),m.default.push(this.modal)}markItemPictureAsLoaded(){var e=document.querySelector(".vk_app_modal_container__pic");e&&(this.modal.props.picClass+=" vk_app_modal_container__pic--loaded",e.onload=()=>{e.classList.add("vk_app_modal_container__pic--loaded")})}getSubscriptionDurationInfo(e){var t=Boolean(e.trial_duration),s=t?getLang("vkapps_connect_modal_subscription_charges_info_after_trial"):getLang("vkapps_connect_modal_subscription_charges_info"),r=(0,qt.langNumeric)(e.price,getLang("apps_connect_n_votes","raw")).replace("{count}",e.price),a=(0,qt.langNumeric)(e.period,getLang("apps_connect_days","raw")).replace("{count}",e.period),i=s.replace("{votes}",r).replace("{period}",a);if(t){var n=(0,qt.langNumeric)(e.trial_duration,getLang("apps_connect_days","raw")).replace("{count}",e.trial_duration);return`\n        <span class="vk_app_modal_container__accent_text_row">${getLang("vkapps_connect_modal_subscription_trial_duration").replace("{days_count}",n)}</span>\n        <br>\n        <span class="vk_app_modal_container__secondary_text_row">${i}</span>\n      `}var o=(0,qt.langNumeric)(Number(e.balance),getLang("apps_connect_n_votes","raw")).replace("{count}",e.balance);return`\n      <span class="vk_app_modal_container__accent_text_row">${i}</span>\n      <br>\n      <span class="vk_app_modal_container__secondary_text_row">${getLang("vkapps_connect_modal_subscription_votes_balance").replace("{votes}",o)}</span>\n    `}getSubscriptionNextBillTimeInfo(e){var t=this.getNextBillTimeText(e.expire_time),s=new RegExp(`(${Object.values(as).join("|")})`,"g");return getLang("vkapps_connect_subscription_duration_info").replace(s,(e=>{switch(e){case as.DATE:return t;case as.LINK_OPEN_TAG:return`<a href="${(0,n.isMvk)()?"/settings?act=subscriptions":"/settings?act=payments&section=subscriptions"}" target="_blank">`;case as.LINK_CLOSE_TAG:return"</a>"}}))}getNextBillTimeText(e){var t=1e3*e,s=getLang("months_of","raw");return langDate(t,"{day} {month} {year}",0,s)}getSubscriptionModalButtons(e){if(!this.isResume&&e.trial_duration)return[[{title:getLang("vkapps_connect_modal_try_for_free"),type:"success"},{title:getLang("vkapps_connect_modal_cancel"),type:"deny"}],ts];var t=this.isResume?getLang("vkapps_connect_modal_resume"):getLang("vkapps_connect_modal_confirm");return[[{title:getLang("vkapps_connect_modal_cancel"),type:"deny"},{title:t,type:"success"}],ss]}getCancelSubscriptionModalButtons(){return[[{title:getLang("vkapps_connect_modal_keep_subscription"),type:"success"},{title:getLang("vkapps_connect_modal_cancel_subscription"),type:"deny"}],es]}getLoaderIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--loader">\n      ${(0,Gt.getIcon44Spinner)().icon}\n    </div>\n    `}getWarningIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--warning">\n      ${(0,Bt.getIcon56ErrorTriangleOutline)().icon}\n    </div>\n    `}}class ns extends a.Handler{constructor(...e){super(...e),this.params.handlerName="VKWebAppShowInstallPushBox",this.isWebOnly=!0}actionHandler(e){window.cur.app.registerVkBridgeCallback("onInstallPushSuccess",(()=>{this.successHandler({success:!0})})),window.cur.app.registerVkBridgeCallback("onInstallPushCancel",(()=>{this.errorHandler({code:h.ERROR_CODES.USER_DENIED})})),window.cur.app.registerVkBridgeCallback("onInstallPushFail",(e=>{this.errorHandler({reason:e})})),window.cur.app.funcs.showInstallPushBox(this.successHandler.bind(this),this.errorHandler.bind(this))}}var os={ID:"id",NAME:"name",SCREEN_NAME:"screen_name",IS_CLOSED:"is_closed",DESCRIPTION:"description",MEMBERS_COUNT:"members_count",PHOTO_50:"photo_50",PHOTO_100:"photo_100",PHOTO_200:"photo_200",IS_MEMBER:"is_member"},ps=2;class cs extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetGroupInfo",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_group_info"),text:getLang("apps_connect_modal_messages_request_group_info_text")},this.callApi=!0,this.useUI=!0}launchUI(e){e[os.PHOTO_100]&&(this.params.modal.pic=e[os.PHOTO_100]),e[os.NAME]&&(this.params.modal.title=`${this.params.modal.title} ${e[os.NAME]}`),this.params.modal.allowAction=()=>this.passGroupInfoResponse(e),this.createDenyUIAction(),this.modal=new R.UIAction({...this.params.modal}),m.default.push(this.modal)}handler(e,t,s){this.setData(e,t),this.callback=s,this.validateParams(e)&&this.loadGroupInfo(e)}validateParams(e){return this.checkParams(e,[{param:"group_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])}loadGroupInfo(e){var{group_id:t}=e,s={fields:Object.values(os).join(","),group_id:t};(0,l.api)("groups.getById",s).then((e=>{var{groups:t=[]}=e;1===t.length?this.checkGroupInfo(t[0]):this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:h.ERROR_REASONS.UNKNOWN_ERROR})})).catch((e=>{var t;this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:(null==e||null==(t=e.error)?void 0:t.error_msg)||h.ERROR_REASONS.UNKNOWN_ERROR})}))}checkGroupInfo(e){if(e[os.IS_CLOSED]!==ps)return this.passGroupInfoResponse(e);0!==e[os.IS_MEMBER]?this.launchUI(e):this.errorHandler({code:h.ERROR_CODES.ACCESS_DENIED,reason:h.ERROR_REASONS.USER_NOT_A_PRIVATE_GROUP_MEMBER,error_type:h.ERROR_TYPES.CLIENT})}passGroupInfoResponse(e){var t=this.sanitizeGroupInfoResponse(e);this.successHandler(t)}sanitizeGroupInfoResponse(e){var t={};return Object.values(os).forEach((s=>{e.hasOwnProperty(s)&&(t[s]=e[s])})),e[os.ID]!==cur.app.options.app_group_id&&delete t[os.IS_MEMBER],t}}class ds extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppFlashGetInfo"}actionHandler(e){this.successHandler({is_available:!1})}}var ls="owner_id",hs="post_id";class _s extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppOpenWallPost",this.isWebOnly=!0}_validateParams(e){return this.checkParams(e,[{param:ls,type:"number",isRequired:!0},{param:hs,type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])}actionHandler(e){this._validateParams(e)&&this._openLayer(e)}_openLayer(e){var t={w:`wall${e[ls]}_${e[hs]}`};window.showWiki(t,null,null,{queue:1,onLoaded:()=>{this.successHandler({result:!0})},onFail:()=>(this.errorHandler({code:h.ERROR_CODES.UNKNOWN,reason:h.ERROR_REASONS.UNKNOWN_ERROR}),!0)})}}var us=s(11417);class ms extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetSilentToken",this.useUI=!0,this.vkConnectIframe=null,this.appIframeParent=null,this.prevAppContainerHeight=0,this.prevAppIframeParentPosition="",this.iframeHandler=this.iframeHandler.bind(this)}launchUI(e){var{params:t}=this.app;if(this.prevAppContainerHeight=cur.app.frame.offsetHeight,void 0===t.need_policy_confirmation)return this.errorHandler(h.ERROR_REASONS.UNSUPPORTED_ACTION);t.need_policy_confirmation?this.initIframe():this.getSilentTokenForce()}initIframe(){var e=this.getIframeUrl();this.vkConnectIframe=this.createIframe(e),(0,n.isMvk)()||this.resizeHeightContainer(528);var t=this.app.vkApp.frame;this.appIframeParent=t.parentNode,this.prevAppIframeParentPosition=this.appIframeParent.style.position,this.appIframeParent.style.position="relative",this.appIframeParent.appendChild(this.vkConnectIframe),window.addEventListener("message",this.iframeHandler)}createIframe(e){var t=document.createElement("iframe");return t.src=e,t.width="100%",t.height="100%",t.frameBorder="0",t.style.cssText="\n      position: absolute;\n      left: 0;\n      top: 0;\n      background: transparent;\n    ",t}destroyIframe(){this.vkConnectIframe.remove(),this.appIframeParent.style.position=this.prevAppIframeParentPosition,this.appIframeParent=null,this.vkConnectIframe=null,(0,n.isMvk)()||this.resizeHeightContainer(this.prevAppContainerHeight),window.removeEventListener("message",this.iframeHandler)}iframeHandler(e){var{vkApp:t}=this.app,s=t.options.vk_app_connect_host,r=(0,K.getHostName)(e.origin)===(0,K.getHostName)(`https://${s}`);e.data&&e.data.type===h.VK_CONNECT_SUPERAPPKIT_EVENT_TYPE&&r&&(e.data.params.error?this.errorHandler(h.ERROR_REASONS.UNKNOWN_ERROR):(this.app.params.need_policy_confirmation=!1,this.successHandler(e.data.params)),this.destroyIframe())}getIframeUrl(){var{vkApp:e}=this.app;return`https://${e.options.vk_app_connect_host}/mini_app_confirm_policy${(0,K.objectToQuerystring)({app_id:this.app.appId,origin:location.origin,theme:us.colorScheme.isDarkScheme()?"dark":"light"})}`}getSilentTokenForce(){return ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},{onDone:e=>{this.handleResponse(e,{},this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)})}resizeHeightContainer(e){cur.app.frame.style.height=`${e}px`,this.app.vkApp.options.boxed||(cur.app.cont.style.height=`${e}px`)}}class Rs extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppOpenReportForm",this.isWebOnly=!0}checkFields(e){return this.checkParams(e,[{param:"type",type:"string",isRequired:!0,extraChecks:[{check:e=>"situational_post"===e,error:()=>h.ERROR_REASONS.UNKNOWN_ERROR}]},{param:"item_id",type:"number",isRequired:!0}])}actionHandler(e){this.checkFields(e)&&this.openReportBox(e)}openReportBox(e){window.stManager.add([window.jsc("web/reports.js"),"reports.css"]).then((()=>{window.showReportBox(e.type,e.owner_id,e.item_id,(e=>{e?this.successHandler({success:!0}):this.errorHandler({reason:h.ERROR_REASONS.USER_DENIED,code:h.ERROR_CODES.USER_DENIED})}))})).catch((()=>this.errorHandler({code:h.ERROR_CODES.UNKNOWN})))}}var Es=s(37668);class As extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppTrackEvent"}get successDescriptor(){return"VKWebAppTrackEventResult"}get errorDescriptor(){return"VKWebAppTrackEventFailed"}actionHandler(e){var{appId:t}=this.app,{event_name:s,custom_user_id:r,event_params:a}=e;if(s){var i={eventName:s};if(r&&(i.customUserId=r),a){if("object"!=typeof a)return void this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:"Expected `event_params` field to be an object"});i.eventParams=a}(0,Es.tmrTrackMiniAppCustom)(t,i),this.successHandler(!0)}else this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,reason:"Missing param `event_name`"})}}class Ss extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppCheckAllowedScopes",this.callApi=!0,this.useUI=!1}actionHandler(e){Ss.isValidScopes(e.scopes)?super.actionHandler(e):this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS})}static isValidScopes(e){if("string"!=typeof e)return!1;if(""===e)return!0;for(var t=window.cur.app.params.whitelist_scopes.split(","),s=e.trim().split(","),r=0;r<s.length;r++)if(!t.includes(s[r]))return!1;return!0}}class Os extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppCheckNativeAds",this.sendSuccessResponse=this.sendSuccessResponse.bind(this),this.sendNoAdsResponse=this.sendNoAdsResponse.bind(this)}sendSuccessResponse(){this.successHandler({result:!0})}sendNoAdsResponse(){this.successHandler({result:!1})}actionHandler(e){if(pt(e)){var t=()=>Ct(this.sendSuccessResponse,this.sendNoAdsResponse),s=e.ad_format;if(s!==We.INTERSTITIAL){var r=void 0===e.use_waterfall||!0===e.use_waterfall?t:this.sendNoAdsResponse;ct((()=>{lt(s,this.sendSuccessResponse,r)}),r)}else t()}else this.sendInvalidParamsError()}sendInvalidParamsError(){this.errorHandler({code:h.ERROR_CODES.INVALID_PARAMS,error_type:h.ERROR_TYPES.CLIENT,reason:h.ERROR_REASONS.INVALID_PARAMS})}}class vs extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetLaunchParams"}actionHandler(){var e={mini_app_id:cur.aid},{vk_app_url:t,gid:s}=cur.app.options;s&&(e.group_id=s),t&&(e.referer=new URLSearchParams(t).get("vk_ref")),(0,l.api)("apps.getAppLaunchParams",e).then((e=>{this.successHandler(e)})).catch((()=>{this.sendConnectionLostError()}))}}class bs extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppActionDone"}handler(e){cur.onExternalAppDone&&cur.onExternalAppDone(e)}}class gs extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppRetargetingPixel"}checkFields(e){return this.checkParams(e,[{param:"pixel_code",type:"string",isRequired:!0},{param:"event",type:"string"},{param:"target_group_id",type:"number"},{param:"price_list_id",type:"number"},{param:"products_event",type:"string"},{param:"products_params",type:"string"}])}actionHandler(e){if(this.checkFields(e)){e.http_ref=this.getAppWebviewUrl(),e.app_id=cur.aid;(0,l.api)("ads.retargetingHit",e).then((e=>{e.success?this.successHandler({result:!0}):this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:e.errors})})).catch((e=>{var t;this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:(null==e||null==(t=e.error)?void 0:t.error_msg)||h.ERROR_REASONS.CONNECTION_LOST})}))}}}var Ns="type",Is="timezone",ks="event",ys="json",Cs="screen",ws="timestamp",fs={TYPE_NAVGO:"type_navgo",TYPE_VIEW:"type_view",TYPE_CLICK:"type_click",TYPE_ACTION:"type_action"},Ps="type",Ts="timezone",Hs="event",Ds="json",Ls="screen",Ms="client_time",Vs="mini_app_id",Ws="url",xs="vk_platform",Ks="user_id";class Us extends a.Handler{constructor(e){super(e),this.FLOOD_RATE={eventsCount:16,timeFrame:2},this.params.handlerName="VKWebAppSendCustomEvent"}_validateParams(e){return this.checkParams(e,[{param:Ns,type:"string",extraChecks:[{check:e=>Object.values(fs).includes(e),error:e=>`Param "${e}" should be one of ${Object.values(fs)}`}]},{param:Is,type:"string"},{param:ks,type:"string",isRequired:!0},{param:ys,type:"string"},{param:Cs,type:"string"},{param:ws,type:"number"}])}_buildEvent(e){var t=e[Ns]||fs.TYPE_ACTION;return{[Ps]:t,[t]:{type:"type_mini_app_custom_event_item"},[Ts]:e[Is]||"",[Hs]:e[ks],[Ds]:e[ys]||"",[Ls]:e[Cs]||"none",[Ms]:e[ws]||Date.now(),[Vs]:cur.app.options.aid,[Ws]:cur.app.options.vk_app_url,[xs]:(0,n.isMvk)()?"mobile_web":"desktop_web",[Ks]:window.vk.id}}actionHandler(e){if(this._validateParams(e)){var t=this._buildEvent(e);(0,l.api)("statEvents.addMiniApps",{events:JSON.stringify([t])}).then((e=>{this.successHandler({result:!0})})).catch((e=>{var t;this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:(null==e||null==(t=e.error)?void 0:t.error_msg)||h.ERROR_REASONS.UNKNOWN_ERROR})}))}}}class Fs extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppConversionHit"}checkFields(e){return this.checkParams(e,[{param:"pixel_code",type:"string",isRequired:!0},{param:"conversion_event",type:"string",isRequired:!0},{param:"conversion_value",type:"number"}])}actionHandler(e){if(this.checkFields(e)){var t={pixel_code:e.pixel_code,conversion_event:e.conversion_event,http_ref:this.getAppWebviewUrl(),app_id:cur.aid};void 0!==e.conversion_value&&(t.conversion_value=e.conversion_value);(0,l.api)("ads.conversionHit",t).then((e=>{e.errors?this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:e.errors}):this.successHandler({result:!0})})).catch((e=>{var t;this.errorHandler({code:h.ERROR_CODES.CUSTOM,reason:(null==e||null==(t=e.error)?void 0:t.error_msg)||h.ERROR_REASONS.CONNECTION_LOST})}))}}}class Bs extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppGetConfig"}actionHandler(){this.successHandler((0,ne.getSchemeConfig)())}}var Gs=s(74476);class qs extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppRecommend",this.useUI=!0,this.params.modal={containerClass:"MiniAppsRecommendUI",buttons:[{title:getLang("apps_connect_modal_btn_undo"),type:"deny"},{title:getLang("apps_connect_modal_btn_recommend"),type:"success"}],title:getLang("apps_connect_modal_title_recommend"),text:getLang("apps_connect_modal_description_recommend"),showCloseBtn:!(0,n.isMvk)(),isNoWrapButtons:!0,svgIcon:(0,Gs.getIcon56ThumbsUpOutline)().icon},this.allowUIAction=this.allowUIAction.bind(this)}allowUIAction(){(0,l.api)("apps.recommend",{app_id:cur.aid,is_recommended:!0}).then((()=>{cur.app.options.is_recommended=!0,this.successHandler({result:!0}),(0,n.isMvk)()||window.Apps.updateRecommendAction(!0)})).catch((()=>{this.successHandler({result:!1})})),m.default.pop(this.modal)}handler(e,t,s){cur.app.options.is_recommended_available&&(this.callback=s,this.setData(e,t),cur.app.options.is_recommended?this.successHandler({result:!0}):((0,n.isMvk)()&&this.params.modal.buttons.reverse(),this.launchUI(e)))}}var $s=s(39822);class js extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppScrollTopStart",this.isWebOnly=!0}actionHandler(){var{appId:e}=this.app;if((0,$s.hasAppInScrollSubscribers)(e))return this.errorHandler({code:h.ERROR_CODES.CUSTOM,error_type:h.ERROR_TYPES.CLIENT,reason:h.ERROR_REASONS.SCROLL_SUBSCRIBER_ALREADY_EXIST});(0,$s.addAppInScrollSubscribers)(e,this.app),this.successHandler({result:!0})}}class Ys extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppScrollTopStop",this.isWebOnly=!0}actionHandler(){var{appId:e}=this.app;(0,$s.removeAppFromScrollSubscribers)(e),this.successHandler({result:!0})}}class Js extends a.Handler{constructor(e){super(e),this.params.handlerName=i.CONNECT_EVENTS.SCROLL_TOP,this.isWebOnly=!0,this.isFromSubscriber=!1}get successDescriptor(){return`${this.params.handlerName}${this.isFromSubscriber?"":"Result"}`}actionHandler(e){var t;if(this.isFromSubscriber=e.from_subscriber,~this.app.containerId.indexOf("layer")){var s=document.querySelector("#wk_layer_wrap");t=(s||document.documentElement).scrollTop}else t=document.documentElement.scrollTop;this.successHandler({scrollTop:t})}}class zs extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppCustomMessage"}actionHandler(e){if(e.action&&e.payload){if(this.app.isTextliveApp){var t,s=null==(t=window.Textlives)?void 0:t.onBridgeEvent(e);return void(s&&s.then(this.successHandler).catch(this.errorHandler))}51459963===this.app.appId&&(this.handleSetNftAvatar(e),this.successHandler({result:!0}))}this.errorHandler()}handleSetNftAvatar({action:e,payload:t}){"VKWebAppSetNFTAvatar"===e&&((0,n.isMvk)()?window.OwnerPhotoUpload2.setNftAvatar(t):window.ajax.post("al_page.php",{act:"owner_avatar_upload",oid:null==t?void 0:t.oid},{onDone:(e,s)=>{window.handleVKBridgeSetNftAvatar(t,e,s)}}))}}class Qs extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppChangeFragment"}get successDescriptor(){return this.params.handlerName}actionHandler({location:e}){this.successHandler({location:e})}}var Xs=s(73871),Zs=s(64309),er=s(40517);const tr="app_survey_iframe";var sr,rr,ar;!function(e){e.VKWebAppOnSurveyAvailable="VKWebAppOnSurveyAvailable",e.VKWebAppOnSurveyLoadFail="VKWebAppOnSurveyLoadFail",e.VKWebAppOnSurveySuccess="VKWebAppOnSurveySuccess",e.VKWebAppOnSurveyUnavailable="VKWebAppOnSurveyUnavailable",e.VKWebAppOnSurveyDecline="VKWebAppOnSurveyDecline"}(sr||(sr={})),function(e){e.CheckSurvey="VKWebAppCheckSurvey",e.ShowSurvey="VKWebAppShowSurvey"}(rr||(rr={})),function(e){e.VKWebAppCheckSurvey="VKWebAppCheckSurvey",e.VKWebAppShowSurvey="VKWebAppShowSurvey"}(ar||(ar={}));const ir={[h.ERROR_REASONS.NETWORK_ERROR]:"network_error",[h.ERROR_REASONS.SURVEY_USER_CANCEL]:"user_deny",[h.ERROR_REASONS.SURVEY_INIT_IN_PROGRESS]:"in_progress",[h.ERROR_REASONS.SURVEY_ALREADY_INIT]:"already_init",[h.ERROR_REASONS.SURVEY_NO_MATCH]:"survey_not_found"};class nr{constructor(e,t,s,r,a){this.onSuccessCallback=null,this.onErrorCallback=null,this.data=e,this.appIframe=t,this.isShow=s,this.onSuccessCallback=r,this.onErrorCallback=a,this.iframeHandler=this.iframeHandler.bind(this),this.methodName=s?ar.VKWebAppShowSurvey:ar.VKWebAppCheckSurvey}onSuccess(){nr.inProgress=!1,Be.surveyMiniAppsEventItemStat.logEvent(window.cur.aid,{event_type:this.isShow?er.SurveyMiniAppsObjectEventType.SHOW:er.SurveyMiniAppsObjectEventType.PRELOAD,is_success:!0,is_test_mode:this.isTestMode}),this.onSuccessCallback&&this.onSuccessCallback(!0),nr.delayedResults.app_survey_inited_success=!0,this.callQueueAndClear(this.methodName,(e=>{e.success()}))}callQueueAndClear(e,t){if(nr.delayedResults.app_survey_result_waiting_queue.has(e)){const s=nr.delayedResults.app_survey_result_waiting_queue.get(e);s&&(s.forEach(t),nr.delayedResults.app_survey_result_waiting_queue.delete(e))}}static logError(e,t,s){Be.surveyMiniAppsEventItemStat.logEvent(window.cur.aid,{event_type:t?er.SurveyMiniAppsObjectEventType.SHOW:er.SurveyMiniAppsObjectEventType.PRELOAD,is_success:!1,error_reason:ir[e.reason],error_code:e.code,is_test_mode:s})}static callError(e,t,s,r){nr.logError(e,t,s),r&&r(e)}onError(e){nr.inProgress=!1,nr.callError(e,this.isShow,this.isTestMode,this.onErrorCallback),nr.delayedResults.app_survey_inited_success=!1,this.callQueueAndClear(this.methodName,(t=>{t.error(e)}))}getIframeTargetOrigin(){const e=new URL(nr.iframeUrl);return e.protocol+"//"+e.hostname}checkSurvey(){nr.surveyIframe&&nr.surveyIframe.contentWindow&&nr.surveyIframe.contentWindow.postMessage({call:rr.CheckSurvey},this.getIframeTargetOrigin())}showSurvey(){nr.surveyIframe&&nr.surveyIframe.contentWindow&&(nr.surveyIframe.style.display="block",nr.surveyIframe.contentWindow.postMessage({call:rr.ShowSurvey},this.getIframeTargetOrigin()),Be.surveyMiniAppsEventItemStat.logEvent(window.cur.aid,{event_type:er.SurveyMiniAppsObjectEventType.DISPLAY,is_success:!0,is_test_mode:this.isTestMode}))}initIframe(e,t){nr.surveyIframe=nr.createIframe(e),nr.iframeUrl=e,nr.appIframeParent=t.parentNode,nr.prevAppIframeParentPosition=nr.appIframeParent.style.position,nr.appIframeParent.style.position="relative",nr.appIframeParent.appendChild(nr.surveyIframe),window.addEventListener("message",this.iframeHandler),nr.surveyIframe.onload=()=>{this.checkSurvey(),this.timeoutId=window.setTimeout((()=>{this.destroyIframe(),this.onError({code:h.ERROR_CODES.CONNECTION_LOST,reason:h.ERROR_REASONS.NETWORK_ERROR})}),12e3)},nr.surveyIframe.onerror=()=>{this.destroyIframe(),this.onError({code:h.ERROR_CODES.CONNECTION_LOST,reason:h.ERROR_REASONS.NETWORK_ERROR})}}iframeHandler(e){if(!e.data)return;if(!((0,K.getHostName)(e.origin)===(0,K.getHostName)(nr.iframeUrl)))return;const{type:t}=e.data;t===sr.VKWebAppOnSurveyDecline&&(e.data.data&&e.data.data.isPrivacy&&nr.surveyDecline(),this.onError({code:h.ERROR_CODES.CUSTOM,reason:h.ERROR_REASONS.SURVEY_USER_CANCEL})),t===sr.VKWebAppOnSurveyAvailable&&(clearTimeout(this.timeoutId),this.isShow?this.showSurvey():(this.onSuccess(),window.removeEventListener("message",this.iframeHandler))),t===sr.VKWebAppOnSurveySuccess&&this.onSuccess(),t===sr.VKWebAppOnSurveyLoadFail&&this.onError({code:h.ERROR_CODES.CONNECTION_LOST,reason:h.ERROR_REASONS.NETWORK_ERROR}),t===sr.VKWebAppOnSurveyUnavailable&&this.onError({code:h.ERROR_CODES.CUSTOM,reason:h.ERROR_REASONS.SURVEY_NO_MATCH}),[sr.VKWebAppOnSurveyLoadFail,sr.VKWebAppOnSurveySuccess,sr.VKWebAppOnSurveyUnavailable,sr.VKWebAppOnSurveyDecline].includes(t)&&this.destroyIframe()}destroyIframe(){nr.inProgress=!1,clearTimeout(this.timeoutId),nr.surveyIframe&&(nr.surveyIframe.remove(),nr.surveyIframe=null),nr.appIframeParent&&(nr.appIframeParent.style.position=nr.prevAppIframeParentPosition,nr.appIframeParent=null),window.removeEventListener("message",this.iframeHandler)}static createIframe(e){const t=document.createElement("iframe");return t.src=e,t.id=tr,t.width="100%",t.height="100%",t.frameBorder="0",t.style.cssText="\n      display: none;\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 4;\n      background: transparent;\n    ",t}static surveyDecline(){const e={app_id:window.cur.aid};(0,l.api)("survey.storeSurveyDecline",e).then((()=>{})).catch((()=>{}))}handle(){let e=!1;if(this.data.hasOwnProperty("test_mode")&&(e=!!this.data.test_mode),nr.inProgress){const t=()=>{nr.callError({code:h.ERROR_CODES.CUSTOM,reason:h.ERROR_REASONS.SURVEY_INIT_IN_PROGRESS},this.isShow,e,this.onErrorCallback)};return void(this.isShow?t():this.appendToQueue(t))}const t=document.getElementById(tr);if(t&&!this.isShow||(nr.inProgress=!0),t)return void this.onExistsIframeHandler(this.isShow);const s={app_id:window.cur.aid};this.data.hasOwnProperty("payload")&&("number"==typeof this.data.payload||"string"==typeof this.data.payload)&&(s.request_id=this.data.payload),e&&(s.test_mode=e),nr.delayedResults||(nr.delayedResults={app_survey_result_waiting_queue:new Map,app_survey_inited_success:!1}),nr.delayedResults.app_survey_result_waiting_queue||(nr.delayedResults.app_survey_result_waiting_queue=new Map),nr.delayedResults.app_survey_result_waiting_queue.set(this.methodName,[]),nr.delayedResults.app_survey_inited_success=!1,nr.callApi(s).then((e=>{this.initIframe(e,this.appIframe)})).catch((e=>{this.onError(e)}))}onExistsIframeHandler(e){e?(this.showSurvey(),window.addEventListener("message",this.iframeHandler)):nr.delayedResults.app_survey_inited_success&&this.onSuccessCallback&&this.onSuccessCallback(!0)}appendToQueue(e){if(nr.delayedResults.app_survey_result_waiting_queue.has(this.methodName)){const e=this.onSuccessCallback,t=this.onErrorCallback,s=nr.delayedResults.app_survey_result_waiting_queue.get(this.methodName);if(!s)return;s.push({success:()=>{e&&e(!0)},error:e=>{t&&t(e)}})}else e()}static callApi(e){return new Promise(((t,s)=>{(0,l.api)("survey.getSurveyData",e).then((({match:e,iframe_url:r})=>{e&&r?t(r):s({code:h.ERROR_CODES.CUSTOM,reason:h.ERROR_REASONS.SURVEY_NO_MATCH})})).catch((()=>{s({code:h.ERROR_CODES.CONNECTION_LOST,reason:h.ERROR_REASONS.NETWORK_ERROR})}))}))}}nr.appIframeParent=null,nr.surveyIframe=null;class or extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppCheckSurvey"}actionHandler(e){new nr(e,this.app.vkApp.frame,!1,this.successHandler,this.errorHandler).handle()}}class pr extends a.Handler{constructor(e){super(e),this.params.handlerName="VKWebAppShowSurvey"}actionHandler(e){new nr(e,this.app.vkApp.frame,!0,this.successHandler,this.errorHandler).handle()}}var cr=(e,t)=>{var s;if(e.frameId){var r=document.getElementById(e.frameId);r&&(s=r.querySelector("iframe"))}else t&&(s=t.querySelector("iframe"));s&&s.contentWindow.postMessage({...e},"*")},dr=(e,t)=>{if(r[e.handler]){var s,a=new r[e.handler]({request_id:e.params.request_id}),i=null==e||null==(s=e.params)?void 0:s.originalHandlerName;i&&(a.params.originalHandlerName=i);var n={...e.params,containerId:t.containerId,pic:e.pic},o=e=>{var s=document.getElementById(t.containerId);e&&s&&cr(e,s)};if(a.FLOOD_RATE){var{eventsCount:p,timeFrame:c}=a.FLOOD_RATE;if(!t.checkBridgeFlood(e.handler,p,c))return a.setData(n,t),a.callback=o,void a.errorHandler({code:h.ERROR_CODES.REQUESTS_LIMIT_REACHED})}a.handler(n,t,o)}}},63533:function(e,t,s){"use strict";s.d(t,{objectToQuerystring:function(){return a},getHostName:function(){return i},destroyOpenedApp:function(){return n},isVKPayApp:function(){return o},filterPostMessageOrigin:function(){return p},isAllowedPostMessageOriginHost:function(){return c}});var r=s(87834),a=e=>Object.keys(e).reduce(((t,s,r)=>[t,0===r?"?":"&",encodeURIComponent(s),"=",encodeURIComponent(e[s])].join("")),""),i=e=>{var t=e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);return null!=t&&t.length>2&&"string"==typeof t[2]&&t[2].length>0?t[2].toLowerCase():null},n=e=>{if(cur.vkAppQueue){var t=Object.keys(cur.vkAppQueue).filter((t=>~t.indexOf(e)));if(t.length>0){var s=t[0];cur.vkAppQueue[s].destroyView(),delete cur.vkAppQueue[s]}}},o=e=>r.VKPAY_APPS.includes(e);function p(e,t){var s=i(t),r=e.vkApp?e.vk_app_url:e.src,a=i(r);if(s!==a&&!c(e,s))throw Error(`Insecure method call from ${s}. Call must be from ${a}`);return!0}function c(e,t){return!!e.allowed_origin_regexp&&new RegExp(e.allowed_origin_regexp).test(t)}},55368:function(e,t,s){"use strict";var r,a;s.d(t,{EVENT_STATES:function(){return r},CONNECT_EVENTS:function(){return a}}),function(e){e.FIRE="",e.FAILURE="Failed",e.SUCCESS="Result"}(r||(r={})),function(e){e.ADD_TO_COMMUNITY="VKWebAppAddToCommunity",e.ADD_TO_COMMUNITY_PRELOAD="VKWebAppAddToCommunityPreload",e.ADD_TO_FAVORITES="VKWebAppAddToFavorites",e.ADD_TO_MENU="VKWebAppAddToMenu",e.ADD_TO_HOME_SCREEN_INFO="VKWebAppAddToHomeScreenInfo",e.ALLOW_MESSAGES_FROM_GROUP="VKWebAppAllowMessagesFromGroup",e.ALLOW_MESSAGES_FROM_GROUP_PRELOAD="VKWebAppAllowMessagesFromGroupPreload",e.ALLOW_NOTIFICATIONS="VKWebAppAllowNotifications",e.ALLOW_NOTIFICATIONS_PRELOAD="VKWebAppAllowNotificationsPreload",e.COPY_TEXT="VKWebAppCopyText",e.CALL_API_METHOD="VKWebAppCallAPIMethod",e.CHANGE_FRAGMENT="VKWebAppChangeFragment",e.CLOSE="VKWebAppClose",e.DENY_NOTIFICATIONS="VKWebAppDenyNotifications",e.FLASH_GET_INFO="VKWebAppFlashGetInfo",e.FLASH_SET_LEVEL="VKWebAppFlashSetLevel",e.GET_AUTH_TOKEN="VKWebAppGetAuthToken",e.GET_AUTH_TOKEN_PRELOAD="VKWebAppGetAuthTokenPreload",e.GET_CLIENT_VERSION="VKWebAppGetClientVersion",e.GET_COMMUNITY_AUTH_TOKEN="VKWebAppGetCommunityAuthToken",e.GET_COMMUNITY_TOKEN="VKWebAppGetCommunityToken",e.GET_EMAIL_PRELOAD="VKWebAppGetEmailPreload",e.GET_EMAIL="VKWebAppGetEmail",e.GET_FRIENDS="VKWebAppGetFriends",e.GET_FLASH_INFO="VKWebAppGetFlashInfo",e.GET_GEODATA="VKWebAppGetGeodata",e.GET_PERSONAL_CARD="VKWebAppGetPersonalCard",e.GET_PHONE_NUMBER_PRELOAD="VKWebAppGetPhoneNumberPreload",e.GET_PHONE_NUMBER="VKWebAppGetPhoneNumber",e.INIT="VKWebAppInit",e.JOIN_GROUP="VKWebAppJoinGroup",e.JOIN_GROUP_PRELOAD="VKWebAppJoinGroupPreload",e.LEAVE_GROUP="VKWebAppLeaveGroup",e.LEAVE_GROUP_PRELOAD="VKWebAppLeaveGroupPreload",e.LOCATION_CHANGED="VKWebAppLocationChanged",e.OPEN_APP="VKWebAppOpenApp",e.OPEN_CONTACTS="VKWebAppOpenContacts",e.OPEN_IN_NATIVE_APP="VKWebAppOpenInNativeApp",e.OPEN_PAY_FORM="VKWebAppOpenPayForm",e.OPEN="VKWebAppOpenQR",e.REDIRECT="VKWebAppRedirect",e.RESIZE_WINDOW="VKWebAppResizeWindow",e.SCROLL="VKWebAppScroll",e.SCROLL_TOP="VKWebAppScrollTop",e.SEND_PAYLOAD="VKWebAppSendPayload",e.SEND_TO_CLIENT="VKWebAppSendToClient",e.SEND_TO_CLIENT_PRELOAD="VKWebAppSendToClientPreload",e.SETTINGS="VKWebAppSettings",e.SET_LOCATION="VKWebAppSetLocation",e.SET_TITLE="VKWebAppSetTitle",e.SET_VIEW_SETTINGS="VKWebAppSetViewSettings",e.SHARE="VKWebAppShare",e.SHOW_NEW_POST_BOX="VKWebAppShowNewPostBox",e.SHOW_IMAGES="VKWebAppShowImages",e.SHOW_INVITE_BOX="VKWebAppShowInviteBox",e.SHOW_STORY_BOX="VKWebAppShowStoryBox",e.SHOW_LEADER_BOARD_BOX="VKWebAppShowLeaderBoardBox",e.SHOW_ORDER_BOX="VKWebAppShowOrderBox",e.SHOW_REQUEST_BOX="VKWebAppShowRequestBox",e.SHOW_WALL_POST_BOX="VKWebAppShowWallPostBox",e.TAPTIC_IMPACT_OCCURRED="VKWebAppTapticImpactOccurred",e.TAPTIC_NOTIFICATION_OCCURRED="VKWebAppTapticNotificationOccurred",e.TAPTIC_SELECTION_CHANGED="VKWebAppTapticSelectionChanged",e.UPDATE_CONFIG="VKWebAppUpdateConfig",e.VIEW_UPDATE_NAVIGATION_STATE="VKWebAppViewUpdateNavigationState",e.OPEN_ARTICLE_EDIT="VKWebAppOpenArticleEditor",e.OPEN_ARTICLE="VKWebAppOpenArticle"}(a||(a={}))},39822:function(e,t,s){"use strict";s.d(t,{hasAppInScrollSubscribers:function(){return a},addAppInScrollSubscribers:function(){return i},removeAppFromScrollSubscribers:function(){return n}});const r={},a=e=>void 0!==r[e],i=(e,t)=>{r[e]=t},n=e=>{delete r[e]}},78225:function(e,t,s){"use strict";s.d(t,{useClassNamesByPlatform:function(){return l}});var r=s(56769),a=s(28412),i=s(61540);const n=[-90,90],o=["landscape-secondary","landscape-primary"],p=navigator.userAgent.toLowerCase(),c=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(p),d=()=>{if(void 0!==window.orientation)return n.includes(Number(window.orientation));const{screen:e}=window,t=(e.orientation||{}).type||e.mozOrientation||e.msOrientation;return o.includes(t)},l=e=>{const[t,s]=(0,r.useState)(d()),n=(0,i.isMvk)()&&c,o=()=>{s(d())};return(0,r.useEffect)((()=>(window.addEventListener("orientationchange",o),()=>window.removeEventListener("orientationchange",o))),[]),(0,a.classNames)(e,{[`${e}--tablet`]:n,[`${e}--mobileWeb`]:(0,i.isMvk)(),[`${e}--web`]:!(0,i.isMvk)(),[`${e}--landscape`]:t})}},16550:function(e,t,s){"use strict";s.d(t,{getSchemeConfig:function(){return a}});var r=s(11417);const a=()=>{const e={app_id:(window.cur.aid||0).toString(),viewport_width:window.innerWidth,viewport_height:window.innerHeight,scheme:r.colorScheme.getScheme(),appearance:r.colorScheme.isDarkScheme()?r.ColorSchemeMode.Dark:r.ColorSchemeMode.Light,api_host:window.vk.apiConfigDomains.apiDomain},t=window.cur.app?.options.layer;return t&&(e.is_layer=!0),e}},27488:function(e,t,s){"use strict";s.d(t,{isProfileButtonAvailable:function(){return n},isProfileButtonInstalled:function(){return p},getProfileButtonHash:function(){return c},addToProfileSuccess:function(){return d},addToProfileFailed:function(){return l},removeFromProfileSuccess:function(){return h},removeFromProfileFailed:function(){return _}});var r=s(73871),a=s(64309),i=s(1581);const n=()=>window.cur.app.options.profile_buttons.available,o=e=>{window.cur.app.options.profile_buttons.installed=e},p=()=>window.cur.app.options.profile_buttons.installed,c=()=>window.cur.app.options.profile_buttons.hash,d=e=>{o(!0),(0,i.getAddToProfileBridgeContext)()&&((new r.VKWebAppAddToProfile).addToProfileSuccess.call((0,i.getAddToProfileBridgeContext)(),e),(0,i.deleteAddToProfileBridgeContext)())},l=e=>{(0,i.getAddToProfileBridgeContext)()&&((new r.VKWebAppAddToProfile).addToProfileFailed.call((0,i.getAddToProfileBridgeContext)(),e),(0,i.deleteAddToProfileBridgeContext)())},h=()=>{o(!1),(0,i.getRemoveFromProfileBridgeContext)()&&((new a.VKWebAppRemoveFromProfile).removeFromProfileSuccess.call((0,i.getRemoveFromProfileBridgeContext)()),(0,i.deleteRemoveFromProfileBridgeContext)())},_=e=>{(0,i.getRemoveFromProfileBridgeContext)()&&((new a.VKWebAppRemoveFromProfile).removeFromProfileFailed.call((0,i.getRemoveFromProfileBridgeContext)(),e),(0,i.deleteRemoveFromProfileBridgeContext)())}},1581:function(e,t,s){"use strict";s.d(t,{getAddToProfileBridgeContext:function(){return r},setAddToProfileBridgeContext:function(){return a},deleteAddToProfileBridgeContext:function(){return i},getRemoveFromProfileBridgeContext:function(){return n},setRemoveFromProfileBridgeContext:function(){return o},deleteRemoveFromProfileBridgeContext:function(){return p}});const r=()=>window.cur.app.VKWebAppAddToProfileContext,a=e=>{window.cur.app.VKWebAppAddToProfileContext=e},i=()=>{delete window.cur.app.VKWebAppAddToProfileContext},n=()=>window.cur.app.VKWebAppRemoveFromProfileContext,o=e=>{window.cur.app.VKWebAppRemoveFromProfileContext=e},p=()=>{delete window.cur.app.VKWebAppRemoveFromProfileContext}}}]);